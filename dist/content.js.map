{"version":3,"file":"content.js","mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://digest-ai-extension/./scripts/content.js"],"sourcesContent":["/**\n * Content Script - å†…å®¹è„šæœ¬\n * ç”¨äºåœ¨ç½‘é¡µä¸­æå–æ–‡ç« å†…å®¹\n */\n\n// ==================== Bilibili é€‚é…å™¨ï¼ˆé›†æˆç‰ˆï¼‰====================\n// ä¸ºé¿å…æ–‡ä»¶åŠ è½½é—®é¢˜ï¼Œå°† BilibiliAdapter ç›´æ¥é›†æˆåˆ° content.js ä¸­\n\nif (window.location.hostname.includes('bilibili.com') && window.location.pathname.includes('/video/')) {\n  console.log('ğŸ¬ æ£€æµ‹åˆ° Bilibili è§†é¢‘é¡µé¢ï¼Œåˆå§‹åŒ–é€‚é…å™¨...');\n  \n  class BilibiliAdapter {\n    constructor() {\n      this.apiBase = 'https://api.bilibili.com';\n    }\n\n    extractVideoId(url) {\n      const bvMatch = url.match(/\\/video\\/(BV[a-zA-Z0-9]+)/);\n      if (bvMatch) return { type: 'bvid', id: bvMatch[1] };\n      const avMatch = url.match(/\\/video\\/av(\\d+)/);\n      if (avMatch) return { type: 'aid', id: avMatch[1] };\n      return null;\n    }\n\n    extractVideoInfoFromPage() {\n      try {\n        const initialState = window.__INITIAL_STATE__;\n        if (!initialState || !initialState.videoData) {\n          throw new Error('æ— æ³•ä»é¡µé¢è·å–è§†é¢‘ä¿¡æ¯');\n        }\n        const videoData = initialState.videoData;\n        return {\n          title: videoData.title || document.title.replace(' - å“”å“©å“”å“©', ''),\n          description: videoData.desc || '',\n          duration: videoData.duration || 0,\n          author: videoData.owner?.name || '',\n          cover: videoData.pic || '',\n          bvid: videoData.bvid || '',\n          aid: videoData.aid || '',\n          cid: videoData.cid || videoData.pages?.[0]?.cid || '',\n          pubdate: videoData.pubdate ? new Date(videoData.pubdate * 1000).toISOString() : '',\n          tags: (videoData.tag || []).map(tag => tag.tag_name || tag),\n          view: videoData.stat?.view || 0,\n          like: videoData.stat?.like || 0,\n          coin: videoData.stat?.coin || 0\n        };\n      } catch (error) {\n        console.error('æå–Bilibiliè§†é¢‘ä¿¡æ¯å¤±è´¥:', error);\n        return this.extractBasicInfoFromDOM();\n      }\n    }\n\n    extractBasicInfoFromDOM() {\n      const titleEl = document.querySelector('h1.video-title') || document.querySelector('.video-title');\n      const descEl = document.querySelector('.video-desc') || document.querySelector('.basic-desc-info');\n      const authorEl = document.querySelector('.up-name') || document.querySelector('.username');\n      return {\n        title: titleEl?.textContent?.trim() || document.title.replace(' - å“”å“©å“”å“©', ''),\n        description: descEl?.textContent?.trim() || '',\n        author: authorEl?.textContent?.trim() || '',\n        duration: 0,\n        cover: '',\n        bvid: this.extractVideoId(window.location.href)?.id || '',\n        aid: '',\n        cid: '',\n        pubdate: '',\n        tags: [],\n        view: 0,\n        like: 0,\n        coin: 0\n      };\n    }\n\n    async getSubtitles(bvid, cid) {\n      try {\n        const subtitleListUrl = `${this.apiBase}/x/player/wbi/v2?bvid=${bvid}&cid=${cid}`;\n        const response = await fetch(subtitleListUrl, {\n          credentials: 'include',\n          headers: { 'Referer': 'https://www.bilibili.com', 'User-Agent': navigator.userAgent }\n        });\n        if (!response.ok) return await this.getSubtitlesFromDOM();\n        const data = await response.json();\n        if (data.code !== 0 || !data.data?.subtitle?.subtitles?.length) {\n          return await this.getSubtitlesFromDOM();\n        }\n        const subtitles = data.data.subtitle.subtitles;\n        const chineseSubtitle = subtitles.find(s => \n          s.lan === 'zh-CN' || s.lan === 'zh-Hans' || s.lan === 'zh-Hant' || s.lan_doc?.includes('ä¸­æ–‡')\n        ) || subtitles[0];\n        if (!chineseSubtitle || !chineseSubtitle.subtitle_url) {\n          return await this.getSubtitlesFromDOM();\n        }\n        const subtitleUrl = chineseSubtitle.subtitle_url.startsWith('http') \n          ? chineseSubtitle.subtitle_url \n          : `https:${chineseSubtitle.subtitle_url}`;\n        const subtitleResponse = await fetch(subtitleUrl);\n        const subtitleData = await subtitleResponse.json();\n        if (!subtitleData.body || !Array.isArray(subtitleData.body)) {\n          return await this.getSubtitlesFromDOM();\n        }\n        return this.formatSubtitles(subtitleData.body);\n      } catch (error) {\n        return await this.getSubtitlesFromDOM();\n      }\n    }\n\n    async getSubtitlesFromDOM() {\n      try {\n        const initialState = window.__INITIAL_STATE__;\n        if (initialState?.videoData?.subtitle?.list) {\n          const subtitleList = initialState.videoData.subtitle.list;\n          if (subtitleList.length > 0) {\n            const subtitle = subtitleList[0];\n            if (subtitle.subtitle_url) {\n              const url = subtitle.subtitle_url.startsWith('http') \n                ? subtitle.subtitle_url \n                : `https:${subtitle.subtitle_url}`;\n              const response = await fetch(url);\n              const data = await response.json();\n              if (data.body) return this.formatSubtitles(data.body);\n            }\n          }\n        }\n        return null;\n      } catch (error) {\n        return null;\n      }\n    }\n\n    async getTopComments(aid, bvid) {\n      try {\n        const oid = aid || bvid;\n        const commentUrl = `${this.apiBase}/x/v2/reply?type=1&oid=${oid}&sort=2&ps=20`;\n        const response = await fetch(commentUrl, {\n          credentials: 'include',\n          headers: { 'Referer': 'https://www.bilibili.com' }\n        });\n        if (!response.ok) return null;\n        const data = await response.json();\n        if (data.code !== 0 || !data.data?.replies?.length) return null;\n        const comments = [];\n        const replies = data.data.replies.slice(0, 20);\n        replies.forEach(reply => {\n          if (reply.content?.message && reply.content.message.length > 5) {\n            const msg = reply.content.message.trim();\n            // è¿‡æ»¤æ‰å¤ªçŸ­æˆ–åªåŒ…å«ç¬¦å·çš„è¯„è®º\n            if (msg.length >= 10 && /[\\u4e00-\\u9fa5a-zA-Z]/.test(msg)) {\n              comments.push({ text: msg, likes: reply.like || 0 });\n            }\n          }\n        });\n        if (comments.length > 0) {\n          comments.sort((a, b) => b.likes - a.likes);\n          return {\n            fullText: comments.map(c => c.text).join('\\n'),\n            count: comments.length,\n            topLikes: comments[0]?.likes || 0\n          };\n        }\n        return null;\n      } catch (error) {\n        return null;\n      }\n    }\n\n    generateTagDescription(tags) {\n      if (!tags || tags.length === 0) return '';\n      return `æœ¬è§†é¢‘çš„ä¸»é¢˜æ ‡ç­¾åŒ…æ‹¬ï¼š${tags.slice(0, 8).join('ã€')}ã€‚`;\n    }\n\n    generateStatsDescription(stats) {\n      if (!stats) return '';\n      const parts = [];\n      if (stats.view > 10000) parts.push(`è¯¥è§†é¢‘æ’­æ”¾é‡è¾¾åˆ°${(stats.view / 10000).toFixed(1)}ä¸‡`);\n      if (stats.like > 1000) parts.push(`è·å¾—${(stats.like / 10000).toFixed(1)}ä¸‡ç‚¹èµ`);\n      if (stats.coin > 500) parts.push(`${(stats.coin / 10000).toFixed(1)}ä¸‡æŠ•å¸`);\n      if (parts.length > 0) return parts.join('ï¼Œ') + 'ï¼Œè¯´æ˜å†…å®¹å—åˆ°è§‚ä¼—æ¬¢è¿ã€‚';\n      return '';\n    }\n\n    formatSubtitles(subtitleBody) {\n      const formatted = { fullText: '', segments: [] };\n      subtitleBody.forEach(segment => {\n        const text = segment.content || '';\n        const timestamp = this.formatTime(segment.from || 0);\n        formatted.fullText += text + ' ';\n        formatted.segments.push({ time: segment.from, timestamp, text });\n      });\n      formatted.fullText = formatted.fullText.trim();\n      return formatted;\n    }\n\n    formatTime(seconds) {\n      const hours = Math.floor(seconds / 3600);\n      const minutes = Math.floor((seconds % 3600) / 60);\n      const secs = Math.floor(seconds % 60);\n      if (hours > 0) {\n        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n      }\n      return `${minutes}:${secs.toString().padStart(2, '0')}`;\n    }\n\n    async extractVideoContent() {\n      try {\n        console.log('ğŸ¬ å¼€å§‹æå– Bilibili è§†é¢‘å†…å®¹...');\n        const videoInfo = this.extractVideoInfoFromPage();\n        console.log('ğŸ“Š Bilibiliè§†é¢‘ä¿¡æ¯:', videoInfo);\n        if (!videoInfo.bvid && !videoInfo.aid) {\n          throw new Error('æ— æ³•è·å–è§†é¢‘ID');\n        }\n        let contentParts = [];\n        let subtitles = null;\n        let comments = null;\n\n        if (videoInfo.bvid && videoInfo.cid) {\n          console.log('ğŸ“ å°è¯•è·å–å­—å¹•...');\n          subtitles = await this.getSubtitles(videoInfo.bvid, videoInfo.cid);\n          if (subtitles && subtitles.fullText) {\n            contentParts.push({ source: 'å­—å¹•', content: subtitles.fullText, weight: 10 });\n            console.log('âœ… æˆåŠŸè·å–å­—å¹•:', subtitles.fullText.length, 'å­—');\n          }\n        }\n\n        if (!subtitles && (videoInfo.aid || videoInfo.bvid)) {\n          console.log('ğŸ’¬ å­—å¹•ä¸å¯ç”¨ï¼Œå°è¯•è·å–çƒ­é—¨è¯„è®º...');\n          comments = await this.getTopComments(videoInfo.aid, videoInfo.bvid);\n          if (comments && comments.fullText) {\n            contentParts.push({ source: 'çƒ­é—¨è¯„è®º', content: comments.fullText, weight: 7 });\n            console.log('âœ… æˆåŠŸè·å–è¯„è®º:', comments.count, 'æ¡');\n          }\n        }\n\n        if (videoInfo.description && videoInfo.description.length > 10) {\n          contentParts.push({\n            source: 'ç®€ä»‹',\n            content: videoInfo.description,\n            weight: subtitles ? 3 : (comments ? 6 : 9)\n          });\n          console.log('ğŸ“„ æ·»åŠ è§†é¢‘ç®€ä»‹:', videoInfo.description.length, 'å­—');\n        }\n\n        if (videoInfo.tags && videoInfo.tags.length > 0) {\n          const tagDesc = this.generateTagDescription(videoInfo.tags);\n          if (tagDesc) {\n            contentParts.push({ source: 'æ ‡ç­¾', content: tagDesc, weight: 2 });\n            console.log('ğŸ·ï¸ æ·»åŠ æ ‡ç­¾æè¿°');\n          }\n        }\n\n        const statsDesc = this.generateStatsDescription({ view: videoInfo.view, like: videoInfo.like, coin: videoInfo.coin });\n        if (statsDesc) {\n          contentParts.push({ source: 'ç»Ÿè®¡', content: statsDesc, weight: 1 });\n          console.log('ğŸ“Š æ·»åŠ ç»Ÿè®¡æè¿°');\n        }\n\n        let finalContent = '';\n        let contentSources = [];\n        if (contentParts.length > 0) {\n          contentParts.sort((a, b) => b.weight - a.weight);\n          contentParts.forEach(part => {\n            if (part.content) {\n              finalContent += part.content + '\\n\\n';\n              contentSources.push(part.source);\n            }\n          });\n          finalContent = finalContent.trim();\n        }\n\n        if (!finalContent) {\n          finalContent = videoInfo.title;\n          contentSources.push('æ ‡é¢˜');\n          console.warn('âš ï¸ æ— æ³•è·å–è§†é¢‘å†…å®¹ï¼Œä½¿ç”¨æ ‡é¢˜');\n        }\n\n        console.log('ğŸ‰ å†…å®¹æå–å®Œæˆï¼æ¥æº:', contentSources.join(' + '), 'æ€»é•¿åº¦:', finalContent.length, 'å­—');\n\n        return {\n          type: 'video-bilibili',\n          title: videoInfo.title,\n          url: window.location.href,\n          videoInfo: videoInfo,\n          content: finalContent,\n          contentSources: contentSources,\n          metadata: {\n            duration: videoInfo.duration,\n            author: videoInfo.author,\n            cover: videoInfo.cover,\n            pubdate: videoInfo.pubdate,\n            tags: videoInfo.tags,\n            stats: { view: videoInfo.view, like: videoInfo.like }\n          },\n          subtitles: subtitles ? {\n            available: true,\n            fullText: subtitles.fullText,\n            segments: subtitles.segments,\n            method: 'api'\n          } : {\n            available: false,\n            message: comments ? \n              `è¯¥è§†é¢‘æ²¡æœ‰å­—å¹•ï¼Œå·²è·å– ${comments.count} æ¡çƒ­é—¨è¯„è®ºä½œä¸ºè¡¥å……` :\n              'è¯¥è§†é¢‘æ²¡æœ‰å­—å¹•ï¼Œå·²ç»¼åˆç®€ä»‹ã€æ ‡ç­¾ç­‰ä¿¡æ¯ç”Ÿæˆæ‘˜è¦'\n          },\n          comments: comments ? {\n            available: true,\n            count: comments.count,\n            topLikes: comments.topLikes,\n            sample: comments.fullText.substring(0, 300) + (comments.fullText.length > 300 ? '...' : '')\n          } : null\n        };\n      } catch (error) {\n        console.error('âŒ æå–Bilibiliè§†é¢‘å†…å®¹å¤±è´¥:', error);\n        throw error;\n      }\n    }\n\n    static isBilibiliVideoPage() {\n      return window.location.hostname.includes('bilibili.com') && \n             window.location.pathname.includes('/video/');\n    }\n  }\n\n  // ç›´æ¥å¯¼å‡ºåˆ° window\n  window.BilibiliAdapter = BilibiliAdapter;\n  console.log('âœ… BilibiliAdapter å·²é›†æˆåˆ° content.js å¹¶å¯¼å‡º');\n}\n\n// ==================== YouTube é€‚é…å™¨ï¼ˆé›†æˆç‰ˆï¼‰====================\n// æ£€æµ‹å¹¶åˆå§‹åŒ– YouTube é€‚é…å™¨\n\nif ((window.location.hostname.includes('youtube.com') && window.location.pathname === '/watch') ||\n    window.location.hostname.includes('youtu.be')) {\n  console.log('ğŸ¬ æ£€æµ‹åˆ° YouTube è§†é¢‘é¡µé¢ï¼Œåˆå§‹åŒ–é€‚é…å™¨...');\n  \n  class YouTubeAdapter {\n    constructor() {\n      this.apiBase = 'https://www.youtube.com';\n    }\n\n    /**\n     * ä» URL æå–è§†é¢‘ ID\n     */\n    extractVideoId(url) {\n      // youtube.com/watch?v=VIDEO_ID\n      const match1 = url.match(/[?&]v=([^&]+)/);\n      if (match1) return match1[1];\n      \n      // youtu.be/VIDEO_ID\n      const match2 = url.match(/youtu\\.be\\/([^?]+)/);\n      if (match2) return match2[1];\n      \n      return null;\n    }\n\n    /**\n     * ä»é¡µé¢æå–è§†é¢‘ä¿¡æ¯\n     */\n    extractVideoInfoFromPage() {\n      try {\n        // YouTube å°†æ•°æ®å­˜å‚¨åœ¨ ytInitialPlayerResponse æˆ– ytInitialData ä¸­\n        let videoData = null;\n        \n        // æ–¹æ³•1: ä» ytInitialPlayerResponse è·å–\n        if (window.ytInitialPlayerResponse) {\n          videoData = window.ytInitialPlayerResponse.videoDetails;\n        }\n        \n        // æ–¹æ³•2: ä» DOM è„šæœ¬æ ‡ç­¾ä¸­æå–\n        if (!videoData) {\n          const scripts = document.querySelectorAll('script');\n          for (const script of scripts) {\n            const content = script.textContent;\n            if (content.includes('ytInitialPlayerResponse')) {\n              const match = content.match(/ytInitialPlayerResponse\\s*=\\s*(\\{.+?\\});/);\n              if (match) {\n                try {\n                  const data = JSON.parse(match[1]);\n                  videoData = data.videoDetails;\n                  break;\n                } catch (e) {\n                  console.warn('è§£æ ytInitialPlayerResponse å¤±è´¥:', e);\n                }\n              }\n            }\n          }\n        }\n        \n        if (!videoData) {\n          throw new Error('æ— æ³•ä»é¡µé¢è·å–è§†é¢‘ä¿¡æ¯');\n        }\n        \n        // æå–æè¿°ï¼ˆä» ytInitialDataï¼‰\n        let description = '';\n        try {\n          if (window.ytInitialData) {\n            const results = window.ytInitialData.contents?.twoColumnWatchNextResults?.results?.results?.contents;\n            if (results) {\n              const videoSecondary = results.find(r => r.videoSecondaryInfoRenderer);\n              if (videoSecondary) {\n                const desc = videoSecondary.videoSecondaryInfoRenderer?.attributedDescription?.content;\n                description = desc || '';\n              }\n            }\n          }\n        } catch (e) {\n          console.warn('æå–æè¿°å¤±è´¥:', e);\n        }\n        \n        return {\n          videoId: videoData.videoId,\n          title: videoData.title || document.title.replace(' - YouTube', ''),\n          description: description || '',\n          duration: parseInt(videoData.lengthSeconds) || 0,\n          author: videoData.author || '',\n          channelId: videoData.channelId || '',\n          viewCount: parseInt(videoData.viewCount) || 0,\n          thumbnail: videoData.thumbnail?.thumbnails?.[0]?.url || ''\n        };\n      } catch (error) {\n        console.error('æå– YouTube è§†é¢‘ä¿¡æ¯å¤±è´¥:', error);\n        return this.extractBasicInfoFromDOM();\n      }\n    }\n\n    /**\n     * ä» DOM æå–åŸºæœ¬ä¿¡æ¯ï¼ˆé™çº§æ–¹æ¡ˆï¼‰\n     */\n    extractBasicInfoFromDOM() {\n      const titleEl = document.querySelector('h1.ytd-video-primary-info-renderer') ||\n                     document.querySelector('h1.title');\n      const channelEl = document.querySelector('ytd-channel-name a') ||\n                       document.querySelector('#owner-name a');\n      \n      return {\n        videoId: this.extractVideoId(window.location.href) || '',\n        title: titleEl?.textContent?.trim() || document.title.replace(' - YouTube', ''),\n        description: '',\n        duration: 0,\n        author: channelEl?.textContent?.trim() || '',\n        channelId: '',\n        viewCount: 0,\n        thumbnail: ''\n      };\n    }\n\n    /**\n     * è·å–è§†é¢‘å­—å¹•\n     */\n    async getSubtitles(videoId) {\n      try {\n        console.log('ğŸ“ å°è¯•è·å– YouTube å­—å¹•...');\n        \n        // YouTube å­—å¹•éœ€è¦é€šè¿‡ timedtext API\n        // æ ¼å¼: https://www.youtube.com/api/timedtext?v=VIDEO_ID&lang=zh-Hans\n        \n        // å…ˆå°è¯•è·å–å­—å¹•åˆ—è¡¨\n        const captionsUrl = `https://www.youtube.com/api/timedtext?v=${videoId}&type=list`;\n        \n        const listResponse = await fetch(captionsUrl);\n        if (!listResponse.ok) {\n          console.warn('æ— æ³•è·å–å­—å¹•åˆ—è¡¨');\n          return null;\n        }\n        \n        const listText = await listResponse.text();\n        const parser = new DOMParser();\n        const listDoc = parser.parseFromString(listText, 'text/xml');\n        const tracks = listDoc.querySelectorAll('track');\n        \n        if (tracks.length === 0) {\n          console.log('è¯¥è§†é¢‘æ²¡æœ‰å­—å¹•');\n          return null;\n        }\n        \n        // ä¼˜å…ˆé€‰æ‹©ä¸­æ–‡å­—å¹•\n        let selectedTrack = null;\n        for (const track of tracks) {\n          const lang = track.getAttribute('lang_code');\n          if (lang?.includes('zh') || lang?.includes('ch')) {\n            selectedTrack = track;\n            break;\n          }\n        }\n        \n        // å¦‚æœæ²¡æœ‰ä¸­æ–‡ï¼Œé€‰æ‹©è‹±æ–‡\n        if (!selectedTrack) {\n          for (const track of tracks) {\n            const lang = track.getAttribute('lang_code');\n            if (lang === 'en') {\n              selectedTrack = track;\n              break;\n            }\n          }\n        }\n        \n        // å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œé€‰ç¬¬ä¸€ä¸ª\n        if (!selectedTrack && tracks.length > 0) {\n          selectedTrack = tracks[0];\n        }\n        \n        if (!selectedTrack) return null;\n        \n        const lang = selectedTrack.getAttribute('lang_code');\n        console.log('âœ… æ‰¾åˆ°å­—å¹•:', selectedTrack.getAttribute('name'), `(${lang})`);\n        \n        // è·å–å­—å¹•å†…å®¹\n        const subtitleUrl = `https://www.youtube.com/api/timedtext?v=${videoId}&lang=${lang}`;\n        const subtitleResponse = await fetch(subtitleUrl);\n        const subtitleText = await subtitleResponse.text();\n        const subtitleDoc = parser.parseFromString(subtitleText, 'text/xml');\n        const textNodes = subtitleDoc.querySelectorAll('text');\n        \n        if (textNodes.length === 0) {\n          console.warn('å­—å¹•å†…å®¹ä¸ºç©º');\n          return null;\n        }\n        \n        let fullText = '';\n        const segments = [];\n        \n        textNodes.forEach(node => {\n          const text = node.textContent.trim();\n          const start = parseFloat(node.getAttribute('start')) || 0;\n          \n          if (text) {\n            fullText += text + ' ';\n            segments.push({\n              time: start,\n              timestamp: this.formatTime(start),\n              text: text\n            });\n          }\n        });\n        \n        fullText = fullText.trim();\n        \n        console.log('ğŸ‰ æˆåŠŸè·å–å­—å¹•ï¼Œå…±', segments.length, 'æ¡');\n        \n        return {\n          fullText: fullText,\n          segments: segments,\n          language: lang\n        };\n      } catch (error) {\n        console.error('è·å– YouTube å­—å¹•å¤±è´¥:', error);\n        return null;\n      }\n    }\n\n    /**\n     * è·å–è§†é¢‘è¯„è®ºï¼ˆä»é¡µé¢ï¼‰\n     */\n    async getTopComments() {\n      try {\n        console.log('ğŸ’¬ å°è¯•ä»é¡µé¢æå–è¯„è®º...');\n        \n        // ç­‰å¾…è¯„è®ºåŠ è½½\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        \n        const commentElements = document.querySelectorAll('ytd-comment-thread-renderer');\n        \n        if (commentElements.length === 0) {\n          console.log('é¡µé¢ä¸Šæ²¡æœ‰æ‰¾åˆ°è¯„è®º');\n          return null;\n        }\n        \n        const comments = [];\n        \n        for (let i = 0; i < Math.min(10, commentElements.length); i++) {\n          const elem = commentElements[i];\n          const textEl = elem.querySelector('#content-text');\n          const likeEl = elem.querySelector('#vote-count-middle');\n          \n          if (textEl) {\n            const text = textEl.textContent.trim();\n            const likes = likeEl?.textContent.trim() || '0';\n            \n            if (text.length >= 10 && /[\\u4e00-\\u9fa5a-zA-Z]/.test(text)) {\n              comments.push({\n                text: text,\n                likes: this.parseLikeCount(likes)\n              });\n            }\n          }\n        }\n        \n        if (comments.length > 0) {\n          comments.sort((a, b) => b.likes - a.likes);\n          \n          console.log('âœ… æˆåŠŸæå–', comments.length, 'æ¡è¯„è®º');\n          \n          return {\n            fullText: comments.map(c => c.text).join('\\n'),\n            count: comments.length,\n            topLikes: comments[0]?.likes || 0\n          };\n        }\n        \n        return null;\n      } catch (error) {\n        console.error('æå–è¯„è®ºå¤±è´¥:', error);\n        return null;\n      }\n    }\n\n    /**\n     * è§£æç‚¹èµæ•°ï¼ˆå¦‚ \"1.2K\" -> 1200ï¼‰\n     */\n    parseLikeCount(str) {\n      if (!str) return 0;\n      str = str.toLowerCase().trim();\n      if (str.includes('k')) {\n        return parseFloat(str) * 1000;\n      } else if (str.includes('m')) {\n        return parseFloat(str) * 1000000;\n      }\n      return parseInt(str) || 0;\n    }\n\n    /**\n     * æ ¼å¼åŒ–æ—¶é—´æˆ³\n     */\n    formatTime(seconds) {\n      const hours = Math.floor(seconds / 3600);\n      const minutes = Math.floor((seconds % 3600) / 60);\n      const secs = Math.floor(seconds % 60);\n      \n      if (hours > 0) {\n        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n      }\n      return `${minutes}:${secs.toString().padStart(2, '0')}`;\n    }\n\n    /**\n     * æå–è§†é¢‘å®Œæ•´å†…å®¹\n     */\n    async extractVideoContent() {\n      try {\n        console.log('ğŸ¬ å¼€å§‹æå– YouTube è§†é¢‘å†…å®¹...');\n        \n        const videoInfo = this.extractVideoInfoFromPage();\n        console.log('ğŸ“Š YouTube è§†é¢‘ä¿¡æ¯:', videoInfo);\n        \n        if (!videoInfo.videoId) {\n          throw new Error('æ— æ³•è·å–è§†é¢‘ID');\n        }\n        \n        let contentParts = [];\n        let subtitles = null;\n        let comments = null;\n        \n        // å°è¯•è·å–å­—å¹•\n        subtitles = await this.getSubtitles(videoInfo.videoId);\n        if (subtitles && subtitles.fullText) {\n          contentParts.push({\n            source: 'å­—å¹•',\n            content: subtitles.fullText,\n            weight: 10\n          });\n          console.log('âœ… æˆåŠŸè·å–å­—å¹•:', subtitles.fullText.length, 'å­—');\n        }\n        \n        // å¦‚æœæ²¡æœ‰å­—å¹•ï¼Œå°è¯•è·å–è¯„è®º\n        if (!subtitles) {\n          console.log('ğŸ’¬ å­—å¹•ä¸å¯ç”¨ï¼Œå°è¯•æå–è¯„è®º...');\n          comments = await this.getTopComments();\n          if (comments && comments.fullText) {\n            contentParts.push({\n              source: 'çƒ­é—¨è¯„è®º',\n              content: comments.fullText,\n              weight: 7\n            });\n            console.log('âœ… æˆåŠŸè·å–è¯„è®º:', comments.count, 'æ¡');\n          }\n        }\n        \n        // æ·»åŠ è§†é¢‘æè¿°\n        if (videoInfo.description && videoInfo.description.length > 10) {\n          contentParts.push({\n            source: 'ç®€ä»‹',\n            content: videoInfo.description,\n            weight: subtitles ? 3 : (comments ? 6 : 9)\n          });\n          console.log('ğŸ“„ æ·»åŠ è§†é¢‘ç®€ä»‹:', videoInfo.description.length, 'å­—');\n        }\n        \n        // ç»„åˆå†…å®¹\n        let finalContent = '';\n        let contentSources = [];\n        \n        if (contentParts.length > 0) {\n          contentParts.sort((a, b) => b.weight - a.weight);\n          contentParts.forEach(part => {\n            if (part.content) {\n              finalContent += part.content + '\\n\\n';\n              contentSources.push(part.source);\n            }\n          });\n          finalContent = finalContent.trim();\n        }\n        \n        if (!finalContent) {\n          finalContent = videoInfo.title;\n          contentSources.push('æ ‡é¢˜');\n          console.warn('âš ï¸ æ— æ³•è·å–è§†é¢‘å†…å®¹ï¼Œä½¿ç”¨æ ‡é¢˜');\n        }\n        \n        console.log('ğŸ‰ å†…å®¹æå–å®Œæˆï¼æ¥æº:', contentSources.join(' + '), 'æ€»é•¿åº¦:', finalContent.length, 'å­—');\n        \n        return {\n          type: 'video-youtube',\n          title: videoInfo.title,\n          url: window.location.href,\n          videoInfo: videoInfo,\n          content: finalContent,\n          contentSources: contentSources,\n          metadata: {\n            duration: videoInfo.duration,\n            author: videoInfo.author,\n            thumbnail: videoInfo.thumbnail,\n            viewCount: videoInfo.viewCount\n          },\n          subtitles: subtitles ? {\n            available: true,\n            fullText: subtitles.fullText,\n            segments: subtitles.segments,\n            language: subtitles.language\n          } : {\n            available: false,\n            message: comments ? \n              `è¯¥è§†é¢‘æ²¡æœ‰å­—å¹•ï¼Œå·²æå– ${comments.count} æ¡çƒ­é—¨è¯„è®ºä½œä¸ºè¡¥å……` :\n              'è¯¥è§†é¢‘æ²¡æœ‰å­—å¹•ï¼Œå·²ä½¿ç”¨ç®€ä»‹ç”Ÿæˆæ‘˜è¦'\n          },\n          comments: comments ? {\n            available: true,\n            count: comments.count,\n            topLikes: comments.topLikes,\n            sample: comments.fullText.substring(0, 300) + (comments.fullText.length > 300 ? '...' : '')\n          } : null\n        };\n      } catch (error) {\n        console.error('âŒ æå– YouTube è§†é¢‘å†…å®¹å¤±è´¥:', error);\n        throw error;\n      }\n    }\n\n    static isYouTubeVideoPage() {\n      return (window.location.hostname.includes('youtube.com') && window.location.pathname === '/watch') ||\n             window.location.hostname.includes('youtu.be');\n    }\n  }\n\n  // å¯¼å‡ºåˆ° window\n  window.YouTubeAdapter = YouTubeAdapter;\n  console.log('âœ… YouTubeAdapter å·²é›†æˆåˆ° content.js å¹¶å¯¼å‡º');\n}\n\n// ==================== PDF é€‚é…å™¨ï¼ˆé›†æˆç‰ˆï¼‰====================\n// æ£€æµ‹å¹¶åˆå§‹åŒ– PDF é€‚é…å™¨\n\nif (window.location.href.endsWith('.pdf') || \n    document.contentType === 'application/pdf' ||\n    window.location.href.includes('chrome-extension://') && window.location.href.includes('.pdf')) {\n  console.log('ğŸ“„ æ£€æµ‹åˆ° PDF æ–‡ä»¶ï¼Œåˆå§‹åŒ–é€‚é…å™¨...');\n  \n  class PDFAdapter {\n    constructor() {\n      this.pdfDocument = null;\n    }\n\n    /**\n     * æ£€æµ‹ PDF.js æ˜¯å¦å¯ç”¨\n     */\n    async ensurePDFJS() {\n      // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ PDF.js\n      if (typeof pdfjsLib !== 'undefined') {\n        return true;\n      }\n\n      // å°è¯•ä» Chrome çš„ PDF viewer ä¸­è®¿é—®\n      if (typeof window.PDFViewerApplication !== 'undefined') {\n        return true;\n      }\n\n      // åŠ¨æ€åŠ è½½ PDF.js\n      try {\n        await this.loadPDFJS();\n        return true;\n      } catch (error) {\n        console.error('æ— æ³•åŠ è½½ PDF.js:', error);\n        return false;\n      }\n    }\n\n    /**\n     * åŠ¨æ€åŠ è½½ PDF.js åº“\n     */\n    async loadPDFJS() {\n      return new Promise((resolve, reject) => {\n        if (typeof pdfjsLib !== 'undefined') {\n          resolve();\n          return;\n        }\n\n        const script = document.createElement('script');\n        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';\n        script.onload = () => {\n          // è®¾ç½® worker\n          if (typeof pdfjsLib !== 'undefined') {\n            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';\n            resolve();\n          } else {\n            reject(new Error('PDF.js åŠ è½½å¤±è´¥'));\n          }\n        };\n        script.onerror = () => reject(new Error('æ— æ³•åŠ è½½ PDF.js è„šæœ¬'));\n        document.head.appendChild(script);\n      });\n    }\n\n    /**\n     * ä» Chrome PDF Viewer è·å–æ–‡æœ¬\n     */\n    async extractFromChromeViewer() {\n      try {\n        console.log('ğŸ” å°è¯•ä» Chrome PDF Viewer æå–æ–‡æœ¬...');\n        \n        // æ–¹æ³•1: ä½¿ç”¨ PDFViewerApplication (Chrome å†…ç½® PDF viewer)\n        if (typeof window.PDFViewerApplication !== 'undefined' && \n            window.PDFViewerApplication.pdfDocument) {\n          const pdfDoc = window.PDFViewerApplication.pdfDocument;\n          const numPages = pdfDoc.numPages;\n          \n          console.log(`ğŸ“„ PDF å…± ${numPages} é¡µ`);\n          \n          let fullText = '';\n          const maxPages = Math.min(numPages, 50); // é™åˆ¶æœ€å¤šæå–50é¡µ\n          \n          for (let i = 1; i <= maxPages; i++) {\n            try {\n              const page = await pdfDoc.getPage(i);\n              const textContent = await page.getTextContent();\n              const pageText = textContent.items.map(item => item.str).join(' ');\n              fullText += pageText + '\\n\\n';\n              \n              if (i % 5 === 0) {\n                console.log(`ğŸ“„ å·²æå– ${i}/${maxPages} é¡µ...`);\n              }\n            } catch (pageError) {\n              console.warn(`âš ï¸ ç¬¬ ${i} é¡µæå–å¤±è´¥:`, pageError);\n            }\n          }\n          \n          if (numPages > maxPages) {\n            console.log(`â„¹ï¸ PDF å…± ${numPages} é¡µï¼Œå·²æå–å‰ ${maxPages} é¡µ`);\n          }\n          \n          return {\n            text: fullText.trim(),\n            pages: numPages,\n            extractedPages: maxPages,\n            method: 'chrome-viewer'\n          };\n        }\n        \n        return null;\n      } catch (error) {\n        console.error('ä» Chrome Viewer æå–å¤±è´¥:', error);\n        return null;\n      }\n    }\n\n    /**\n     * ä½¿ç”¨ PDF.js ç›´æ¥è§£æ PDF\n     */\n    async extractUsingPDFJS(url) {\n      try {\n        console.log('ğŸ” ä½¿ç”¨ PDF.js è§£æ PDF...');\n        \n        if (typeof pdfjsLib === 'undefined') {\n          throw new Error('PDF.js æœªåŠ è½½');\n        }\n        \n        const loadingTask = pdfjsLib.getDocument(url);\n        const pdf = await loadingTask.promise;\n        const numPages = pdf.numPages;\n        \n        console.log(`ğŸ“„ PDF å…± ${numPages} é¡µ`);\n        \n        let fullText = '';\n        const maxPages = Math.min(numPages, 50);\n        \n        for (let i = 1; i <= maxPages; i++) {\n          const page = await pdf.getPage(i);\n          const textContent = await page.getTextContent();\n          const pageText = textContent.items.map(item => item.str).join(' ');\n          fullText += pageText + '\\n\\n';\n          \n          if (i % 5 === 0) {\n            console.log(`ğŸ“„ å·²æå– ${i}/${maxPages} é¡µ...`);\n          }\n        }\n        \n        if (numPages > maxPages) {\n          console.log(`â„¹ï¸ PDF å…± ${numPages} é¡µï¼Œå·²æå–å‰ ${maxPages} é¡µ`);\n        }\n        \n        return {\n          text: fullText.trim(),\n          pages: numPages,\n          extractedPages: maxPages,\n          method: 'pdfjs'\n        };\n      } catch (error) {\n        console.error('ä½¿ç”¨ PDF.js è§£æå¤±è´¥:', error);\n        return null;\n      }\n    }\n\n    /**\n     * ä» DOM æå–å¯è§æ–‡æœ¬ï¼ˆé™çº§æ–¹æ¡ˆï¼‰\n     */\n    extractFromDOM() {\n      try {\n        console.log('ğŸ” å°è¯•ä» DOM æå–æ–‡æœ¬...');\n        \n        // æŸ¥æ‰¾æ‰€æœ‰æ–‡æœ¬å±‚\n        const textLayers = document.querySelectorAll('.textLayer');\n        \n        if (textLayers.length > 0) {\n          let text = '';\n          textLayers.forEach((layer, index) => {\n            const layerText = layer.textContent || '';\n            text += layerText + '\\n\\n';\n          });\n          \n          console.log(`âœ… ä» DOM æå–äº† ${textLayers.length} ä¸ªæ–‡æœ¬å±‚`);\n          \n          return {\n            text: text.trim(),\n            pages: textLayers.length,\n            extractedPages: textLayers.length,\n            method: 'dom'\n          };\n        }\n        \n        // å¦‚æœæ²¡æœ‰æ–‡æœ¬å±‚ï¼Œå°è¯•æå–æ‰€æœ‰å¯è§æ–‡æœ¬\n        const bodyText = document.body.textContent || '';\n        if (bodyText.length > 100) {\n          console.log('âœ… ä» body æå–äº†æ–‡æœ¬');\n          return {\n            text: bodyText.trim(),\n            pages: 1,\n            extractedPages: 1,\n            method: 'body'\n          };\n        }\n        \n        return null;\n      } catch (error) {\n        console.error('ä» DOM æå–å¤±è´¥:', error);\n        return null;\n      }\n    }\n\n    /**\n     * æå– PDF å…ƒæ•°æ®\n     */\n    async extractMetadata() {\n      try {\n        // ä» Chrome Viewer è·å–\n        if (typeof window.PDFViewerApplication !== 'undefined' && \n            window.PDFViewerApplication.pdfDocument) {\n          const metadata = await window.PDFViewerApplication.pdfDocument.getMetadata();\n          return {\n            title: metadata.info?.Title || '',\n            author: metadata.info?.Author || '',\n            subject: metadata.info?.Subject || '',\n            keywords: metadata.info?.Keywords || '',\n            creator: metadata.info?.Creator || '',\n            producer: metadata.info?.Producer || '',\n            creationDate: metadata.info?.CreationDate || '',\n            modificationDate: metadata.info?.ModDate || ''\n          };\n        }\n        \n        return null;\n      } catch (error) {\n        console.warn('æå–å…ƒæ•°æ®å¤±è´¥:', error);\n        return null;\n      }\n    }\n\n    /**\n     * ä»æ–‡ä»¶åæå–æ ‡é¢˜\n     */\n    getTitleFromURL() {\n      const url = window.location.href;\n      \n      // ä» URL ä¸­æå–æ–‡ä»¶å\n      const matches = url.match(/([^\\/]+)\\.pdf/i);\n      if (matches && matches[1]) {\n        let title = matches[1];\n        // è§£ç  URL ç¼–ç \n        title = decodeURIComponent(title);\n        // æ›¿æ¢è¿å­—ç¬¦å’Œä¸‹åˆ’çº¿ä¸ºç©ºæ ¼\n        title = title.replace(/[-_]/g, ' ');\n        return title;\n      }\n      \n      return document.title || 'PDFæ–‡æ¡£';\n    }\n\n    /**\n     * æå–å®Œæ•´çš„ PDF å†…å®¹\n     */\n    async extractPDFContent() {\n      try {\n        console.log('ğŸ“„ å¼€å§‹æå– PDF å†…å®¹...');\n        \n        let extractResult = null;\n        \n        // æ–¹æ³•1: ä» Chrome PDF Viewer æå–\n        extractResult = await this.extractFromChromeViewer();\n        \n        // æ–¹æ³•2: å¦‚æœæ–¹æ³•1å¤±è´¥ï¼Œå°è¯•åŠ è½½ PDF.js\n        if (!extractResult || !extractResult.text) {\n          const pdfJSReady = await this.ensurePDFJS();\n          if (pdfJSReady) {\n            extractResult = await this.extractUsingPDFJS(window.location.href);\n          }\n        }\n        \n        // æ–¹æ³•3: ä» DOM æå–ï¼ˆé™çº§æ–¹æ¡ˆï¼‰\n        if (!extractResult || !extractResult.text) {\n          extractResult = this.extractFromDOM();\n        }\n        \n        if (!extractResult || !extractResult.text) {\n          throw new Error('æ— æ³•æå– PDF æ–‡æœ¬å†…å®¹');\n        }\n        \n        console.log(`âœ… æˆåŠŸæå– PDF æ–‡æœ¬ï¼Œå…± ${extractResult.text.length} å­—`);\n        console.log(`ğŸ“Š æ–¹æ³•: ${extractResult.method}, é¡µæ•°: ${extractResult.extractedPages}/${extractResult.pages}`);\n        \n        // æå–å…ƒæ•°æ®\n        const metadata = await this.extractMetadata();\n        \n        // è·å–æ ‡é¢˜\n        let title = this.getTitleFromURL();\n        if (metadata && metadata.title) {\n          title = metadata.title;\n        }\n        \n        // ç”Ÿæˆæ‘˜è¦æ–‡æœ¬ï¼ˆå–å‰å‡ æ®µä½œä¸ºæ‘˜è¦ï¼‰\n        const paragraphs = extractResult.text.split('\\n\\n').filter(p => p.trim().length > 20);\n        const excerpt = paragraphs.slice(0, 3).join('\\n\\n').substring(0, 500);\n        \n        return {\n          type: 'document-pdf',\n          title: title,\n          url: window.location.href,\n          content: extractResult.text,\n          excerpt: excerpt,\n          metadata: {\n            pages: extractResult.pages,\n            extractedPages: extractResult.extractedPages,\n            extractMethod: extractResult.method,\n            ...metadata,\n            fileSize: this.formatFileSize(extractResult.text.length),\n            wordCount: this.countWords(extractResult.text)\n          },\n          contentSources: ['PDFæ–‡æœ¬']\n        };\n      } catch (error) {\n        console.error('âŒ æå– PDF å†…å®¹å¤±è´¥:', error);\n        throw error;\n      }\n    }\n\n    /**\n     * æ ¼å¼åŒ–æ–‡ä»¶å¤§å°\n     */\n    formatFileSize(bytes) {\n      if (bytes < 1024) return bytes + ' B';\n      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';\n      return (bytes / 1024 / 1024).toFixed(2) + ' MB';\n    }\n\n    /**\n     * ç»Ÿè®¡å­—æ•°\n     */\n    countWords(text) {\n      // ä¸­æ–‡å­—ç¬¦ + è‹±æ–‡å•è¯\n      const chineseChars = (text.match(/[\\u4e00-\\u9fa5]/g) || []).length;\n      const englishWords = (text.match(/[a-zA-Z]+/g) || []).length;\n      return chineseChars + englishWords;\n    }\n\n    static isPDFPage() {\n      return window.location.href.endsWith('.pdf') || \n             document.contentType === 'application/pdf' ||\n             (window.location.href.includes('chrome-extension://') && window.location.href.includes('.pdf'));\n    }\n  }\n\n  // å¯¼å‡ºåˆ° window\n  window.PDFAdapter = PDFAdapter;\n  console.log('âœ… PDFAdapter å·²é›†æˆåˆ° content.js å¹¶å¯¼å‡º');\n}\n\n// ==================== æ‚¬æµ®çƒåˆå§‹åŒ– ====================\n\n// åˆå§‹åŒ–æ‚¬æµ®çƒ\n(async function initFloatButton() {\n  try {\n    // æ£€æŸ¥æ˜¯å¦å¯ç”¨æ‚¬æµ®çƒ\n    const { enableFloatButton } = await chrome.storage.local.get(['enableFloatButton']);\n    const enabled = enableFloatButton !== undefined ? enableFloatButton : true;\n    \n    console.log('æ‚¬æµ®çƒè®¾ç½®:', enabled);\n    \n    if (!enabled) {\n      console.log('æ‚¬æµ®çƒå·²ç¦ç”¨');\n      return;\n    }\n    \n    // åˆ›å»ºæ‚¬æµ®çƒ\n    createFloatButton();\n  } catch (error) {\n    console.error('åˆå§‹åŒ–æ‚¬æµ®çƒå¤±è´¥:', error);\n  }\n})();\n\n// ç›‘å¬è®¾ç½®å˜åŒ–\nchrome.storage.onChanged.addListener((changes, areaName) => {\n  if (areaName === 'local' && changes.enableFloatButton) {\n    const enabled = changes.enableFloatButton.newValue;\n    console.log('æ‚¬æµ®çƒè®¾ç½®å·²æ›´æ”¹:', enabled);\n    \n    const existingButton = document.getElementById('digest-ai-float-button');\n    if (enabled && !existingButton) {\n      createFloatButton();\n    } else if (!enabled && existingButton) {\n      existingButton.remove();\n      const styles = document.getElementById('digest-ai-float-styles');\n      if (styles) styles.remove();\n      const toastStyles = document.getElementById('digest-ai-toast-styles');\n      if (toastStyles) toastStyles.remove();\n    }\n  }\n});\n\n/**\n * åˆ›å»ºæ‚¬æµ®çƒ\n */\nfunction createFloatButton() {\n  // é¿å…é‡å¤åˆ›å»º\n  if (document.getElementById('digest-ai-float-button')) {\n    return;\n  }\n  \n  // åˆ›å»ºæŒ‰é’®\n  const button = document.createElement('div');\n  button.id = 'digest-ai-float-button';\n  button.innerHTML = `\n    <div class=\"float-btn-icon\">ğŸ“š</div>\n    <div class=\"float-btn-tooltip\">ä¿å­˜æ–‡ç« </div>\n  `;\n  \n  // æ³¨å…¥æ ·å¼\n  injectFloatButtonStyles();\n  \n  // æ·»åŠ åˆ°é¡µé¢\n  document.body.appendChild(button);\n  \n  // åŠ è½½ä¿å­˜çš„ä½ç½®\n  loadButtonPosition(button);\n  \n  // ç»‘å®šäº‹ä»¶\n  let isDragging = false;\n  let startX = 0;\n  let startY = 0;\n  let offsetX = 0;\n  let offsetY = 0;\n  \n  button.addEventListener('mousedown', (e) => {\n    if (e.button !== 0) return;\n    isDragging = true;\n    button.classList.add('dragging');\n    \n    const rect = button.getBoundingClientRect();\n    offsetX = e.clientX - rect.left;\n    offsetY = e.clientY - rect.top;\n    startX = e.clientX;\n    startY = e.clientY;\n    \n    e.preventDefault();\n  });\n  \n  document.addEventListener('mousemove', (e) => {\n    if (!isDragging) return;\n    \n    const x = e.clientX - offsetX;\n    const y = e.clientY - offsetY;\n    \n    const maxX = window.innerWidth - button.offsetWidth;\n    const maxY = window.innerHeight - button.offsetHeight;\n    \n    button.style.left = `${Math.max(0, Math.min(x, maxX))}px`;\n    button.style.top = `${Math.max(0, Math.min(y, maxY))}px`;\n    button.style.right = 'auto';\n    button.style.bottom = 'auto';\n    \n    e.preventDefault();\n  });\n  \n  document.addEventListener('mouseup', async (e) => {\n    if (!isDragging) return;\n    \n    isDragging = false;\n    button.classList.remove('dragging');\n    \n    const moveDistance = Math.sqrt(\n      Math.pow(e.clientX - startX, 2) + \n      Math.pow(e.clientY - startY, 2)\n    );\n    \n    if (moveDistance < 5) {\n      // ç‚¹å‡» - ä¿å­˜æ–‡ç« \n      await handleSaveArticle(button);\n    } else {\n      // æ‹–åŠ¨ - ä¿å­˜ä½ç½®\n      await saveButtonPosition(button);\n    }\n  });\n}\n\n/**\n * æ³¨å…¥æ ·å¼\n */\nfunction injectFloatButtonStyles() {\n  if (document.getElementById('digest-ai-float-styles')) {\n    return;\n  }\n  \n  const style = document.createElement('style');\n  style.id = 'digest-ai-float-styles';\n  style.textContent = `\n    #digest-ai-float-button {\n      position: fixed;\n      right: 20px;\n      bottom: 100px;\n      width: 56px;\n      height: 56px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      border-radius: 50%;\n      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n      cursor: pointer;\n      z-index: 2147483647;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      user-select: none;\n    }\n    \n    #digest-ai-float-button:hover {\n      transform: scale(1.1);\n      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);\n    }\n    \n    #digest-ai-float-button:active {\n      transform: scale(0.95);\n    }\n    \n    #digest-ai-float-button.dragging {\n      cursor: grabbing;\n      opacity: 0.8;\n    }\n    \n    .float-btn-icon {\n      font-size: 24px;\n      line-height: 1;\n    }\n    \n    .float-btn-tooltip {\n      position: absolute;\n      right: 70px;\n      background: rgba(0, 0, 0, 0.8);\n      color: white;\n      padding: 6px 12px;\n      border-radius: 6px;\n      font-size: 13px;\n      white-space: nowrap;\n      opacity: 0;\n      pointer-events: none;\n      transition: opacity 0.2s;\n    }\n    \n    #digest-ai-float-button:hover .float-btn-tooltip {\n      opacity: 1;\n    }\n    \n    .float-btn-tooltip::after {\n      content: '';\n      position: absolute;\n      right: -6px;\n      top: 50%;\n      transform: translateY(-50%);\n      border: 6px solid transparent;\n      border-left-color: rgba(0, 0, 0, 0.8);\n    }\n    \n    #digest-ai-float-button.saving {\n      animation: digest-ai-pulse 1s ease-in-out infinite;\n    }\n    \n    @keyframes digest-ai-pulse {\n      0%, 100% { transform: scale(1); }\n      50% { transform: scale(1.05); }\n    }\n    \n    .digest-ai-toast {\n      position: fixed;\n      top: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: rgba(0, 0, 0, 0.9);\n      color: white;\n      padding: 12px 24px;\n      border-radius: 8px;\n      font-size: 14px;\n      z-index: 1000000;\n      animation: digest-ai-slideDown 0.3s ease-out;\n    }\n    \n    .digest-ai-toast.success {\n      background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n    }\n    \n    .digest-ai-toast.error {\n      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n    }\n    \n    @keyframes digest-ai-slideDown {\n      from {\n        opacity: 0;\n        transform: translateX(-50%) translateY(-20px);\n      }\n      to {\n        opacity: 1;\n        transform: translateX(-50%) translateY(0);\n      }\n    }\n  `;\n  \n  document.head.appendChild(style);\n}\n\n/**\n * ä¿å­˜æ–‡ç« \n */\nasync function handleSaveArticle(button) {\n  button.classList.add('saving');\n  \n  try {\n    const response = await chrome.runtime.sendMessage({\n      action: 'saveArticle',\n      url: window.location.href,\n      title: document.title\n    });\n    \n    if (response && response.success) {\n      showToast('âœ… æ–‡ç« å·²ä¿å­˜', 'success');\n    } else {\n      throw new Error(response?.error || 'ä¿å­˜å¤±è´¥');\n    }\n  } catch (error) {\n    console.error('ä¿å­˜æ–‡ç« å¤±è´¥:', error);\n    showToast('âŒ ' + error.message, 'error');\n  } finally {\n    button.classList.remove('saving');\n  }\n}\n\n/**\n * æ˜¾ç¤ºæç¤º\n */\nfunction showToast(message, type = 'info') {\n  const existingToast = document.getElementById('digest-ai-toast');\n  if (existingToast) {\n    existingToast.remove();\n  }\n  \n  const toast = document.createElement('div');\n  toast.id = 'digest-ai-toast';\n  toast.textContent = message;\n  toast.className = `digest-ai-toast ${type}`;\n  \n  document.body.appendChild(toast);\n  \n  setTimeout(() => {\n    toast.style.animation = 'digest-ai-slideDown 0.3s ease-out reverse';\n    setTimeout(() => toast.remove(), 300);\n  }, 3000);\n}\n\n/**\n * ä¿å­˜ä½ç½®\n */\nasync function saveButtonPosition(button) {\n  const position = {\n    left: button.style.left,\n    top: button.style.top\n  };\n  \n  await chrome.storage.local.set({ floatButtonPosition: position });\n}\n\n/**\n * åŠ è½½ä½ç½®\n */\nasync function loadButtonPosition(button) {\n  const { floatButtonPosition } = await chrome.storage.local.get(['floatButtonPosition']);\n  \n  if (floatButtonPosition?.left && floatButtonPosition?.top) {\n    const leftPx = parseInt(floatButtonPosition.left, 10);\n    const topPx = parseInt(floatButtonPosition.top, 10);\n    const maxX = window.innerWidth - 56;\n    const maxY = window.innerHeight - 56;\n    const clampedLeft = Math.max(0, Math.min(isNaN(leftPx) ? 0 : leftPx, maxX));\n    const clampedTop = Math.max(0, Math.min(isNaN(topPx) ? 0 : topPx, maxY));\n    button.style.left = `${clampedLeft}px`;\n    button.style.top = `${clampedTop}px`;\n    button.style.right = 'auto';\n    button.style.bottom = 'auto';\n  }\n}\n\n// ç›‘å¬æ¥è‡ª background.js çš„æ¶ˆæ¯\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n  if (request.action === 'extractContent') {\n    // å¼‚æ­¥å¤„ç†æå–é€»è¾‘\n    (async () => {\n      try {\n        const extractedContent = await extractContent();\n        sendResponse({ success: true, content: extractedContent });\n      } catch (error) {\n        console.error('æå–å†…å®¹å¤±è´¥:', error);\n        sendResponse({ success: false, error: error.message });\n      }\n    })();\n    return true; // ä¿æŒæ¶ˆæ¯é€šé“å¼€å¯ä»¥æ”¯æŒå¼‚æ­¥å“åº”\n  }\n  return false;\n});\n\n/**\n * æ£€æµ‹å†…å®¹ç±»å‹å¹¶æå–ç›¸åº”å†…å®¹\n */\nasync function extractContent() {\n  const contentType = detectContentType();\n  \n  console.log('æ£€æµ‹åˆ°å†…å®¹ç±»å‹:', contentType);\n  \n  switch (contentType) {\n    case 'document-pdf':\n      return await extractPDFDocument();\n    case 'video-bilibili':\n      return await extractBilibiliVideo();\n    case 'video-youtube':\n      return await extractYouTubeVideo();\n    default:\n      return extractArticleContent();\n  }\n}\n\n/**\n * æ£€æµ‹å½“å‰é¡µé¢çš„å†…å®¹ç±»å‹\n */\nfunction detectContentType() {\n  const url = window.location.href;\n  const hostname = window.location.hostname;\n  \n  // PDF æ–‡æ¡£\n  if (url.endsWith('.pdf') || \n      document.contentType === 'application/pdf' ||\n      (url.includes('chrome-extension://') && url.includes('.pdf'))) {\n    return 'document-pdf';\n  }\n  \n  // Bilibili è§†é¢‘é¡µé¢\n  if (hostname.includes('bilibili.com') && url.includes('/video/')) {\n    return 'video-bilibili';\n  }\n  \n  // YouTube è§†é¢‘é¡µé¢\n  if (hostname.includes('youtube.com') && url.includes('/watch')) {\n    return 'video-youtube';\n  }\n  \n  // é»˜è®¤ä¸ºç½‘é¡µæ–‡ç« \n  return 'webpage';\n}\n\n/**\n * æå– Bilibili è§†é¢‘å†…å®¹ï¼ˆä½¿ç”¨é›†æˆçš„é€‚é…å™¨ï¼‰\n */\nasync function extractBilibiliVideo() {\n  try {\n    console.log('ğŸ¬ ä½¿ç”¨é›†æˆçš„ BilibiliAdapter æå–è§†é¢‘å†…å®¹...');\n    \n    // BilibiliAdapter å·²åœ¨æ–‡ä»¶å¼€å¤´å®šä¹‰ï¼Œç›´æ¥ä½¿ç”¨\n    if (typeof BilibiliAdapter === 'undefined') {\n      throw new Error('BilibiliAdapter æœªå®šä¹‰ï¼Œè¿™ä¸åº”è¯¥å‘ç”Ÿï¼');\n    }\n    \n    const adapter = new BilibiliAdapter();\n    const videoContent = await adapter.extractVideoContent();\n    \n    return videoContent;\n  } catch (error) {\n    console.error('âŒ æå–Bilibiliè§†é¢‘å¤±è´¥:', error);\n    throw new Error('æå–è§†é¢‘å†…å®¹å¤±è´¥: ' + error.message);\n  }\n}\n\n/**\n * æå– YouTube è§†é¢‘å†…å®¹ï¼ˆä½¿ç”¨é›†æˆçš„é€‚é…å™¨ï¼‰\n */\nasync function extractYouTubeVideo() {\n  try {\n    console.log('ğŸ¬ ä½¿ç”¨é›†æˆçš„ YouTubeAdapter æå–è§†é¢‘å†…å®¹...');\n    \n    // YouTubeAdapter å·²åœ¨æ–‡ä»¶å¼€å¤´å®šä¹‰ï¼Œç›´æ¥ä½¿ç”¨\n    if (typeof YouTubeAdapter === 'undefined') {\n      throw new Error('YouTubeAdapter æœªå®šä¹‰ï¼Œè¿™ä¸åº”è¯¥å‘ç”Ÿï¼');\n    }\n    \n    const adapter = new YouTubeAdapter();\n    const videoContent = await adapter.extractVideoContent();\n    \n    return videoContent;\n  } catch (error) {\n    console.error('âŒ æå– YouTube è§†é¢‘å¤±è´¥:', error);\n    throw new Error('æå–è§†é¢‘å†…å®¹å¤±è´¥: ' + error.message);\n  }\n}\n\n/**\n * æå– PDF æ–‡æ¡£å†…å®¹ï¼ˆä½¿ç”¨é›†æˆçš„é€‚é…å™¨ï¼‰\n */\nasync function extractPDFDocument() {\n  try {\n    console.log('ğŸ“„ ä½¿ç”¨é›†æˆçš„ PDFAdapter æå–æ–‡æ¡£å†…å®¹...');\n    \n    // PDFAdapter å·²åœ¨æ–‡ä»¶å¼€å¤´å®šä¹‰ï¼Œç›´æ¥ä½¿ç”¨\n    if (typeof PDFAdapter === 'undefined') {\n      throw new Error('PDFAdapter æœªå®šä¹‰ï¼Œè¿™ä¸åº”è¯¥å‘ç”Ÿï¼');\n    }\n    \n    const adapter = new PDFAdapter();\n    const pdfContent = await adapter.extractPDFContent();\n    \n    return pdfContent;\n  } catch (error) {\n    console.error('âŒ æå– PDF æ–‡æ¡£å¤±è´¥:', error);\n    throw new Error('æå–æ–‡æ¡£å†…å®¹å¤±è´¥: ' + error.message);\n  }\n}\n\n/**\n * æå–æ–‡ç« å†…å®¹\n * ä½¿ç”¨ Readability åº“æˆ–è‡ªå®šä¹‰æå–é€»è¾‘\n */\nfunction extractArticleContent() {\n  // å…‹éš†å½“å‰æ–‡æ¡£ä»¥é¿å…ä¿®æ”¹åŸå§‹ DOM\n  const documentClone = document.cloneNode(true);\n  \n  // ä½¿ç”¨ Readability æå–å†…å®¹ï¼ˆå¦‚æœå¯ç”¨ï¼‰\n  if (typeof Readability !== 'undefined') {\n    try {\n      const reader = new Readability(documentClone);\n      const article = reader.parse();\n      \n      if (article) {\n        return {\n          type: 'webpage',\n          title: article.title || document.title,\n          content: article.textContent || '',\n          htmlContent: article.content || '',\n          excerpt: article.excerpt || '',\n          byline: article.byline || '',\n          siteName: getSiteName(),\n          length: article.length || 0\n        };\n      }\n    } catch (error) {\n      console.warn('Readability æå–å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ³•:', error);\n    }\n  }\n  \n  // å¤‡ç”¨æå–æ–¹æ³•\n  return fallbackExtraction();\n}\n\n/**\n * å¤‡ç”¨æå–æ–¹æ³•\n * å½“ Readability ä¸å¯ç”¨æˆ–å¤±è´¥æ—¶ä½¿ç”¨\n */\nfunction fallbackExtraction() {\n  // å°è¯•æŸ¥æ‰¾ä¸»è¦å†…å®¹åŒºåŸŸ\n  const mainSelectors = [\n    'article',\n    '[role=\"main\"]',\n    'main',\n    '.article-content',\n    '.post-content',\n    '.entry-content',\n    '#content',\n    '.content'\n  ];\n  \n  let mainContent = null;\n  \n  for (const selector of mainSelectors) {\n    const element = document.querySelector(selector);\n    if (element && element.textContent.trim().length > 200) {\n      mainContent = element;\n      break;\n    }\n  }\n  \n  // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¸»è¦å†…å®¹ï¼Œä½¿ç”¨ body\n  if (!mainContent) {\n    mainContent = document.body;\n  }\n  \n  // æå–æ–‡æœ¬å†…å®¹\n  const content = extractTextFromElement(mainContent);\n  \n  return {\n    type: 'webpage',\n    title: extractTitle(),\n    content: content,\n    htmlContent: mainContent.innerHTML,\n    excerpt: content.substring(0, 300),\n    byline: extractAuthor(),\n    siteName: getSiteName(),\n    length: content.length\n  };\n}\n\n/**\n * ä»å…ƒç´ ä¸­æå–æ–‡æœ¬\n */\nfunction extractTextFromElement(element) {\n  // ç§»é™¤ä¸éœ€è¦çš„å…ƒç´ \n  const clone = element.cloneNode(true);\n  const unwantedSelectors = [\n    'script',\n    'style',\n    'nav',\n    'header',\n    'footer',\n    'iframe',\n    '.ad',\n    '.advertisement',\n    '.social-share',\n    '.comments'\n  ];\n  \n  unwantedSelectors.forEach(selector => {\n    const elements = clone.querySelectorAll(selector);\n    elements.forEach(el => el.remove());\n  });\n  \n  // è·å–æ–‡æœ¬å†…å®¹å¹¶æ¸…ç†\n  let text = clone.textContent || '';\n  \n  // æ¸…ç†å¤šä½™çš„ç©ºç™½\n  text = text.replace(/\\s+/g, ' ').trim();\n  \n  return text;\n}\n\n/**\n * æå–æ ‡é¢˜\n */\nfunction extractTitle() {\n  // å°è¯•å¤šç§æ–¹å¼è·å–æ ‡é¢˜\n  const titleSelectors = [\n    'h1',\n    '.article-title',\n    '.post-title',\n    '[property=\"og:title\"]',\n    '[name=\"twitter:title\"]'\n  ];\n  \n  for (const selector of titleSelectors) {\n    const element = document.querySelector(selector);\n    if (element) {\n      return element.getAttribute('content') || element.textContent.trim();\n    }\n  }\n  \n  return document.title;\n}\n\n/**\n * æå–ä½œè€…ä¿¡æ¯\n */\nfunction extractAuthor() {\n  const authorSelectors = [\n    '[rel=\"author\"]',\n    '.author',\n    '.byline',\n    '[property=\"article:author\"]',\n    '[name=\"author\"]'\n  ];\n  \n  for (const selector of authorSelectors) {\n    const element = document.querySelector(selector);\n    if (element) {\n      return element.getAttribute('content') || element.textContent.trim();\n    }\n  }\n  \n  return '';\n}\n\n/**\n * è·å–ç½‘ç«™åç§°\n */\nfunction getSiteName() {\n  // å°è¯•ä» meta æ ‡ç­¾è·å–\n  const siteNameMeta = document.querySelector('[property=\"og:site_name\"]');\n  if (siteNameMeta) {\n    return siteNameMeta.getAttribute('content');\n  }\n  \n  // ä»åŸŸåæå–\n  try {\n    const hostname = window.location.hostname;\n    return hostname.replace(/^www\\./, '');\n  } catch (error) {\n    return '';\n  }\n}\n\n/**\n * é«˜äº®æ˜¾ç¤ºæå–çš„å†…å®¹ï¼ˆç”¨äºè°ƒè¯•ï¼‰\n */\nfunction highlightExtractedContent() {\n  const article = document.querySelector('article');\n  if (article) {\n    article.style.outline = '2px solid #667eea';\n    article.style.backgroundColor = 'rgba(102, 126, 234, 0.05)';\n  }\n}\n\n// å¯é€‰ï¼šåœ¨å¼€å‘æ¨¡å¼ä¸‹æ˜¾ç¤ºæå–ç»“æœ\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  console.log('Content script loaded');\n}\n\n"],"names":[],"sourceRoot":""}