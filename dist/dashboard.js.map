{"version":3,"file":"dashboard.js","mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://digest-ai-extension/./dashboard.js"],"sourcesContent":["/**\n * Dashboard é¡µé¢é€»è¾‘\n * å¤„ç†é˜…è¯»åº“çš„æ–‡ç« åˆ—è¡¨å’Œå†…å®¹å±•ç¤º\n */\n\n// å…¨å±€çŠ¶æ€\nlet allArticles = [];\nlet currentArticle = null;\nlet filteredArticles = [];\nlet allTags = new Set();\n\n// DOM å…ƒç´ \nconst elements = {\n  // åˆ—è¡¨é¢æ¿\n  articlesList: document.getElementById('articlesList'),\n  emptyState: document.getElementById('emptyState'),\n  searchInput: document.getElementById('searchInput'),\n  tagFilter: document.getElementById('tagFilter'),\n  settingsBtn: document.getElementById('settingsBtn'),\n  themeToggleBtn: document.getElementById('themeToggleBtn'),\n  \n  // å†…å®¹é¢æ¿\n  welcomeView: document.getElementById('welcomeView'),\n  articleView: document.getElementById('articleView'),\n  \n  // æ–‡ç« è¯¦æƒ…\n  articleTitle: document.getElementById('articleTitle'),\n  articleSource: document.getElementById('articleSource'),\n  articleDate: document.getElementById('articleDate'),\n  articleSummary: document.getElementById('articleSummary'),\n  articleKeyPoints: document.getElementById('articleKeyPoints'),\n  articleBody: document.getElementById('articleBody'),\n  articleTagsList: document.getElementById('articleTagsList'),\n  \n  // å…ƒæ•°æ®\n  metaSource: document.getElementById('metaSource'),\n  metaDate: document.getElementById('metaDate'),\n  metaUrl: document.getElementById('metaUrl'),\n  metaLength: document.getElementById('metaLength'),\n  \n  // æ“ä½œæŒ‰é’®\n  openOriginalBtn: document.getElementById('openOriginalBtn'),\n  exportMarkdownBtn: document.getElementById('exportMarkdownBtn'),\n  deleteArticleBtn: document.getElementById('deleteArticleBtn'),\n  addTagBtn: document.getElementById('addTagBtn'),\n  \n  // æ¨¡æ€æ¡†\n  tagModal: document.getElementById('tagModal'),\n  newTagInput: document.getElementById('newTagInput'),\n  confirmTagBtn: document.getElementById('confirmTagBtn'),\n  cancelTagBtn: document.getElementById('cancelTagBtn')\n};\n\n/**\n * åŠ è½½æ‰€æœ‰æ–‡ç« \n */\nasync function loadArticles() {\n  try {\n    const response = await chrome.runtime.sendMessage({ action: 'getArticles' });\n    \n    if (response.success) {\n      allArticles = response.articles || [];\n      filteredArticles = [...allArticles];\n      \n      // æå–æ‰€æœ‰æ ‡ç­¾\n      extractAllTags();\n      \n      // æ¸²æŸ“åˆ—è¡¨\n      renderArticleList();\n      \n      // æ›´æ–°æ ‡ç­¾ç­›é€‰å™¨\n      updateTagFilter();\n      \n      // å¦‚æœæœ‰æ–‡ç« ï¼Œæ˜¾ç¤ºç¬¬ä¸€ç¯‡\n      if (allArticles.length > 0) {\n        selectArticle(allArticles[0]);\n      }\n    }\n  } catch (error) {\n    console.error('åŠ è½½æ–‡ç« å¤±è´¥:', error);\n  }\n}\n\n/**\n * æå–æ‰€æœ‰æ ‡ç­¾\n */\nfunction extractAllTags() {\n  allTags.clear();\n  allArticles.forEach(article => {\n    if (article.tags && Array.isArray(article.tags)) {\n      article.tags.forEach(tag => allTags.add(tag));\n    }\n  });\n}\n\n/**\n * æ›´æ–°æ ‡ç­¾ç­›é€‰å™¨\n */\nfunction updateTagFilter() {\n  const currentValue = elements.tagFilter.value;\n  \n  // æ¸…ç©ºå¹¶é‡æ–°å¡«å……\n  elements.tagFilter.innerHTML = '<option value=\"\">æ‰€æœ‰æ ‡ç­¾</option>';\n  \n  Array.from(allTags).sort().forEach(tag => {\n    const option = document.createElement('option');\n    option.value = tag;\n    option.textContent = tag;\n    elements.tagFilter.appendChild(option);\n  });\n  \n  // æ¢å¤ä¹‹å‰çš„é€‰æ‹©\n  if (currentValue && allTags.has(currentValue)) {\n    elements.tagFilter.value = currentValue;\n  }\n}\n\n/**\n * æ¸²æŸ“æ–‡ç« åˆ—è¡¨\n */\nfunction renderArticleList() {\n  // æ¸…ç©ºåˆ—è¡¨\n  elements.articlesList.innerHTML = '';\n  \n  // æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ç« \n  if (filteredArticles.length === 0) {\n    elements.emptyState.classList.remove('hidden');\n    elements.articlesList.classList.add('hidden');\n    return;\n  }\n  \n  elements.emptyState.classList.add('hidden');\n  elements.articlesList.classList.remove('hidden');\n  \n  // æ¸²æŸ“æ¯ç¯‡æ–‡ç« \n  filteredArticles.forEach(article => {\n    const item = createArticleItem(article);\n    elements.articlesList.appendChild(item);\n  });\n}\n\n/**\n * åˆ›å»ºæ–‡ç« åˆ—è¡¨é¡¹\n */\nfunction createArticleItem(article) {\n  const div = document.createElement('div');\n  div.className = 'article-item';\n  div.dataset.id = article.id;\n  \n  // æ£€æµ‹å†…å®¹ç±»å‹\n  const isVideo = article.type && article.type.startsWith('video-');\n  if (isVideo) {\n    div.classList.add('video-item');\n  }\n  \n  const date = new Date(article.dateAdded);\n  const dateStr = formatDate(date);\n  \n  // è§†é¢‘ç±»å‹æ·»åŠ å›¾æ ‡å’Œæ—¶é•¿\n  const typeIcon = isVideo ? 'ğŸ¥ ' : '';\n  const durationStr = isVideo && article.videoMetadata?.duration \n    ? ` â€¢ ${formatDuration(article.videoMetadata.duration)}` \n    : '';\n  \n  div.innerHTML = `\n    <div class=\"article-item-title\">${typeIcon}${escapeHtml(article.title)}</div>\n    <div class=\"article-item-meta\">\n      <span class=\"article-item-source\">${escapeHtml(article.source)}</span>\n      <span>â€¢</span>\n      <span>${dateStr}</span>\n      ${durationStr ? `<span>${durationStr}</span>` : ''}\n    </div>\n  `;\n  \n  // ç‚¹å‡»äº‹ä»¶\n  div.addEventListener('click', () => {\n    selectArticle(article);\n  });\n  \n  // å¦‚æœæ˜¯å½“å‰æ–‡ç« ï¼Œæ·»åŠ  active ç±»\n  if (currentArticle && currentArticle.id === article.id) {\n    div.classList.add('active');\n  }\n  \n  return div;\n}\n\n/**\n * é€‰æ‹©æ–‡ç« \n */\nfunction selectArticle(article) {\n  currentArticle = article;\n  \n  // æ›´æ–°åˆ—è¡¨é¡¹çš„ active çŠ¶æ€\n  document.querySelectorAll('.article-item').forEach(item => {\n    item.classList.remove('active');\n    if (item.dataset.id === article.id) {\n      item.classList.add('active');\n    }\n  });\n  \n  // æ˜¾ç¤ºæ–‡ç« è¯¦æƒ…\n  showArticleDetails(article);\n}\n\n/**\n * æ˜¾ç¤ºæ–‡ç« è¯¦æƒ…\n */\nfunction showArticleDetails(article) {\n  // åˆ‡æ¢è§†å›¾\n  elements.welcomeView.classList.add('hidden');\n  elements.articleView.classList.remove('hidden');\n  \n  // åŸºæœ¬ä¿¡æ¯\n  elements.articleTitle.textContent = article.title;\n  elements.articleSource.textContent = article.source;\n  \n  const date = new Date(article.dateAdded);\n  elements.articleDate.textContent = formatDate(date);\n  \n  // AI åˆ†æ\n  elements.articleSummary.textContent = article.summary || 'æš‚æ— æ‘˜è¦';\n  \n  // æ ¸å¿ƒè§‚ç‚¹\n  elements.articleKeyPoints.innerHTML = '';\n  if (article.keyPoints && article.keyPoints.length > 0) {\n    article.keyPoints.forEach(point => {\n      const li = document.createElement('li');\n      li.textContent = point;\n      elements.articleKeyPoints.appendChild(li);\n    });\n  } else {\n    const li = document.createElement('li');\n    li.textContent = 'æš‚æ— æ ¸å¿ƒè§‚ç‚¹';\n    elements.articleKeyPoints.appendChild(li);\n  }\n  \n  // åŸæ–‡å†…å®¹ï¼ˆåŒºåˆ†è§†é¢‘å’Œæ–‡ç« ï¼‰\n  const isVideo = article.type && article.type.startsWith('video-');\n  \n  if (isVideo) {\n    // è§†é¢‘å†…å®¹ç‰¹æ®Šå¤„ç†\n    const videoMeta = article.videoMetadata || {};\n    const hasSubtitles = videoMeta.subtitles?.available;\n    const subtitleText = hasSubtitles ? videoMeta.subtitles.fullText : '';\n    \n    elements.articleBody.innerHTML = `\n      <div class=\"video-content-box\">\n        <div class=\"video-header\">\n          <h3>ğŸ¥ è§†é¢‘ä¿¡æ¯</h3>\n        </div>\n        \n        <div class=\"video-metadata\">\n          ${videoMeta.duration ? `<div class=\"meta-item\"><strong>æ—¶é•¿:</strong> ${formatDuration(videoMeta.duration)}</div>` : ''}\n          ${videoMeta.author ? `<div class=\"meta-item\"><strong>UPä¸»:</strong> ${escapeHtml(videoMeta.author)}</div>` : ''}\n          ${videoMeta.pubdate ? `<div class=\"meta-item\"><strong>å‘å¸ƒ:</strong> ${new Date(videoMeta.pubdate).toLocaleDateString('zh-CN')}</div>` : ''}\n          ${videoMeta.stats?.view ? `<div class=\"meta-item\"><strong>æ’­æ”¾:</strong> ${videoMeta.stats.view.toLocaleString()}</div>` : ''}\n          ${videoMeta.stats?.like ? `<div class=\"meta-item\"><strong>ç‚¹èµ:</strong> ${videoMeta.stats.like.toLocaleString()}</div>` : ''}\n        </div>\n        \n        ${article.contentSources ? `\n          <div class=\"content-sources\">\n            <strong>ğŸ“Š å†…å®¹æ¥æºï¼š</strong>\n            <span class=\"source-tags\">\n              ${article.contentSources.map(src => {\n                const icons = { 'å­—å¹•': 'ğŸ“', 'çƒ­é—¨è¯„è®º': 'ğŸ’¬', 'ç®€ä»‹': 'ğŸ“„', 'æ ‡ç­¾': 'ğŸ·ï¸', 'ç»Ÿè®¡': 'ğŸ“Š' };\n                return `<span class=\"source-tag\">${icons[src] || 'ğŸ“Œ'} ${src}</span>`;\n              }).join('')}\n            </span>\n          </div>\n        ` : ''}\n        \n        ${hasSubtitles ? `\n          <div class=\"video-subtitles\">\n            <h4>ğŸ“ è§†é¢‘å­—å¹• ${videoMeta.subtitles?.method === 'dom' ? '(ä»é¡µé¢æå–)' : ''}</h4>\n            <div class=\"subtitle-text\">${escapeHtml(subtitleText)}</div>\n          </div>\n        ` : videoMeta.comments?.available ? `\n          <div class=\"video-comments\">\n            <h4>ğŸ’¬ çƒ­é—¨è¯„è®º (${videoMeta.comments.count} æ¡ï¼Œæœ€é«˜ ${videoMeta.comments.topLikes} èµ)</h4>\n            <div class=\"comments-sample\">\n              <p style=\"color: #666; font-size: 13px; margin-bottom: 10px;\">\n                â„¹ï¸ ç”±äºè§†é¢‘æ²¡æœ‰å­—å¹•ï¼Œå·²æå–çƒ­é—¨è¯„è®ºä½œä¸ºå†…å®¹è¡¥å……\n              </p>\n              <div class=\"subtitle-text\">${escapeHtml(videoMeta.comments.sample)}</div>\n            </div>\n          </div>\n        ` : `\n          <div class=\"no-subtitles\">\n            <p>âš ï¸ æ­¤è§†é¢‘æ²¡æœ‰å­—å¹•</p>\n            <p style=\"color: #999; font-size: 14px;\">${videoMeta.subtitles?.message || 'å·²ç»¼åˆç®€ä»‹ã€æ ‡ç­¾ç­‰ä¿¡æ¯ç”Ÿæˆæ‘˜è¦'}</p>\n          </div>\n        `}\n        \n        ${article.excerpt ? `\n          <div class=\"video-description\">\n            <h4>ğŸ“„ è§†é¢‘ç®€ä»‹</h4>\n            <p>${escapeHtml(article.excerpt)}</p>\n          </div>\n        ` : ''}\n        \n        <div class=\"video-actions\">\n          <a href=\"${article.url}\" target=\"_blank\" class=\"video-link-btn\">\n            ğŸ”— è§‚çœ‹è§†é¢‘\n          </a>\n        </div>\n      </div>\n    `;\n  } else if (article.htmlContent) {\n    elements.articleBody.innerHTML = sanitizeHtml(article.htmlContent);\n  } else if (article.content) {\n    elements.articleBody.textContent = article.content;\n  } else if (article.hasOriginalContent === false) {\n    // ç”¨æˆ·é€‰æ‹©ä¸ä¿å­˜åŸæ–‡\n    elements.articleBody.innerHTML = `\n      <div style=\"text-align: center; padding: 40px 20px; color: #666;\">\n        <div style=\"font-size: 48px; margin-bottom: 16px;\">ğŸ“</div>\n        <p style=\"font-size: 16px; margin-bottom: 8px;\">æ­¤æ–‡ç« æœªä¿å­˜åŸæ–‡å†…å®¹</p>\n        <p style=\"font-size: 14px; color: #999;\">ä»…ä¿å­˜äº† AI ç”Ÿæˆçš„æ‘˜è¦å’Œå…³é”®è§‚ç‚¹</p>\n        <a href=\"${article.url}\" target=\"_blank\" style=\"display: inline-block; margin-top: 16px; padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 6px;\">è®¿é—®åŸæ–‡é“¾æ¥</a>\n      </div>\n    `;\n  } else {\n    elements.articleBody.textContent = 'å†…å®¹ä¸å¯ç”¨';\n  }\n  \n  // åˆå§‹åŒ–é«˜äº®å’Œç¬”è®°åŠŸèƒ½\n  if (window.highlightManager) {\n    window.highlightManager.init(\n      article.id,\n      elements.articleBody,\n      article.highlights || []\n    );\n  }\n  \n  // æ ‡ç­¾\n  renderArticleTags(article.tags || []);\n  \n  // å…ƒæ•°æ®\n  elements.metaSource.textContent = article.source;\n  elements.metaDate.textContent = new Date(article.dateAdded).toLocaleString('zh-CN');\n  elements.metaUrl.href = article.url;\n  elements.metaUrl.textContent = article.url;\n  elements.metaLength.textContent = `${article.content ? article.content.length : 0} å­—`;\n  \n  // æ»šåŠ¨åˆ°é¡¶éƒ¨\n  elements.articleView.parentElement.scrollTop = 0;\n}\n\n/**\n * æ¸²æŸ“æ–‡ç« æ ‡ç­¾\n */\nfunction renderArticleTags(tags) {\n  elements.articleTagsList.innerHTML = '';\n  \n  tags.forEach(tag => {\n    const span = document.createElement('span');\n    span.className = 'tag';\n    span.innerHTML = `\n      ${escapeHtml(tag)}\n      <span class=\"tag-remove\" data-tag=\"${escapeHtml(tag)}\">Ã—</span>\n    `;\n    elements.articleTagsList.appendChild(span);\n  });\n}\n\n/**\n * æœç´¢æ–‡ç« \n */\nfunction searchArticles(query) {\n  query = query.toLowerCase().trim();\n  \n  if (!query) {\n    filteredArticles = [...allArticles];\n  } else {\n    filteredArticles = allArticles.filter(article => {\n      const titleMatch = article.title.toLowerCase().includes(query);\n      const contentMatch = article.content && article.content.toLowerCase().includes(query);\n      const summaryMatch = article.summary && article.summary.toLowerCase().includes(query);\n      \n      return titleMatch || contentMatch || summaryMatch;\n    });\n  }\n  \n  applyTagFilter();\n}\n\n/**\n * åº”ç”¨æ ‡ç­¾ç­›é€‰\n */\nfunction applyTagFilter() {\n  const selectedTag = elements.tagFilter.value;\n  \n  if (selectedTag) {\n    filteredArticles = filteredArticles.filter(article => {\n      return article.tags && article.tags.includes(selectedTag);\n    });\n  }\n  \n  renderArticleList();\n}\n\n/**\n * æ·»åŠ æ ‡ç­¾\n */\nasync function addTag(tag) {\n  tag = tag.trim();\n  \n  if (!tag || !currentArticle) {\n    return;\n  }\n  \n  const tags = currentArticle.tags || [];\n  \n  if (tags.includes(tag)) {\n    showWarning('æ ‡ç­¾å·²å­˜åœ¨');\n    return;\n  }\n  \n  tags.push(tag);\n  \n  try {\n    await chrome.runtime.sendMessage({\n      action: 'updateArticleTags',\n      articleId: currentArticle.id,\n      tags: tags\n    });\n    \n    currentArticle.tags = tags;\n    renderArticleTags(tags);\n    \n    // æ›´æ–°å…¨å±€æ ‡ç­¾é›†åˆ\n    allTags.add(tag);\n    updateTagFilter();\n    \n    // å…³é—­æ¨¡æ€æ¡†\n    closeTagModal();\n    showSuccess(`æ ‡ç­¾\"${tag}\"å·²æ·»åŠ `);\n  } catch (error) {\n    console.error('æ·»åŠ æ ‡ç­¾å¤±è´¥:', error);\n    showError('æ·»åŠ æ ‡ç­¾å¤±è´¥: ' + error.message);\n  }\n}\n\n/**\n * åˆ é™¤æ ‡ç­¾\n */\nasync function removeTag(tag) {\n  if (!currentArticle) {\n    return;\n  }\n  \n  const tags = (currentArticle.tags || []).filter(t => t !== tag);\n  \n  try {\n    await chrome.runtime.sendMessage({\n      action: 'updateArticleTags',\n      articleId: currentArticle.id,\n      tags: tags\n    });\n    \n    currentArticle.tags = tags;\n    renderArticleTags(tags);\n    \n    // é‡æ–°åŠ è½½æ–‡ç« ä»¥æ›´æ–°æ ‡ç­¾é›†åˆ\n    await loadArticles();\n  } catch (error) {\n    console.error('åˆ é™¤æ ‡ç­¾å¤±è´¥:', error);\n    alert('åˆ é™¤æ ‡ç­¾å¤±è´¥');\n  }\n}\n\n/**\n * åˆ é™¤æ–‡ç« \n */\nasync function deleteArticle() {\n  if (!currentArticle) {\n    return;\n  }\n  \n  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿ')) {\n    return;\n  }\n  \n  const hideLoading = showLoading('æ­£åœ¨åˆ é™¤æ–‡ç« ...');\n  \n  try {\n    await chrome.runtime.sendMessage({\n      action: 'deleteArticle',\n      articleId: currentArticle.id\n    });\n    \n    hideLoading();\n    showSuccess('æ–‡ç« å·²åˆ é™¤');\n    \n    // é‡æ–°åŠ è½½æ–‡ç« åˆ—è¡¨\n    await loadArticles();\n  } catch (error) {\n    hideLoading();\n    console.error('åˆ é™¤æ–‡ç« å¤±è´¥:', error);\n    showError('åˆ é™¤æ–‡ç« å¤±è´¥: ' + error.message);\n  }\n}\n\n/**\n * æ‰“å¼€æ ‡ç­¾æ¨¡æ€æ¡†\n */\nfunction openTagModal() {\n  elements.tagModal.classList.remove('hidden');\n  elements.newTagInput.value = '';\n  elements.newTagInput.focus();\n}\n\n/**\n * å…³é—­æ ‡ç­¾æ¨¡æ€æ¡†\n */\nfunction closeTagModal() {\n  elements.tagModal.classList.add('hidden');\n  elements.newTagInput.value = '';\n}\n\n/**\n * æ ¼å¼åŒ–æ—¥æœŸ\n */\nfunction formatDate(date) {\n  const now = new Date();\n  const diff = now - date;\n  \n  const minutes = Math.floor(diff / 60000);\n  const hours = Math.floor(diff / 3600000);\n  const days = Math.floor(diff / 86400000);\n  \n  if (minutes < 60) {\n    return `${minutes} åˆ†é’Ÿå‰`;\n  } else if (hours < 24) {\n    return `${hours} å°æ—¶å‰`;\n  } else if (days < 7) {\n    return `${days} å¤©å‰`;\n  } else {\n    return date.toLocaleDateString('zh-CN');\n  }\n}\n\n/**\n * è½¬ä¹‰ HTML\n */\nfunction escapeHtml(text) {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * ç®€å•çš„ HTML æ¸…ç†ï¼ˆç§»é™¤å±é™©æ ‡ç­¾ï¼‰\n */\nfunction sanitizeHtml(html) {\n  const div = document.createElement('div');\n  div.innerHTML = html;\n  \n  // ç§»é™¤å±é™©æ ‡ç­¾\n  const dangerousTags = ['script', 'iframe', 'object', 'embed', 'link'];\n  dangerousTags.forEach(tag => {\n    const elements = div.querySelectorAll(tag);\n    elements.forEach(el => el.remove());\n  });\n  \n  return div.innerHTML;\n}\n\n/**\n * å¯¼å‡ºæ–‡ç« ä¸º Markdown æ ¼å¼\n */\nfunction exportToMarkdown(article) {\n  try {\n    // æ„å»º Markdown å†…å®¹\n    let markdown = '';\n    \n    // æ ‡é¢˜\n    markdown += `# ${article.title}\\n\\n`;\n    \n    // å…ƒæ•°æ®\n    markdown += `**æ¥æº**: ${article.source}  \\n`;\n    markdown += `**åŸæ–‡é“¾æ¥**: ${article.url}  \\n`;\n    markdown += `**ä¿å­˜æ—¶é—´**: ${new Date(article.dateAdded).toLocaleString('zh-CN')}  \\n`;\n    \n    // æ ‡ç­¾\n    if (article.tags && article.tags.length > 0) {\n      markdown += `**æ ‡ç­¾**: ${article.tags.join(', ')}  \\n`;\n    }\n    \n    markdown += `\\n---\\n\\n`;\n    \n    // AI æ‘˜è¦\n    markdown += `## ğŸ“ AI æ‘˜è¦\\n\\n`;\n    markdown += `${article.summary || 'æš‚æ— æ‘˜è¦'}\\n\\n`;\n    \n    // æ ¸å¿ƒè§‚ç‚¹\n    markdown += `## ğŸ’¡ æ ¸å¿ƒè§‚ç‚¹\\n\\n`;\n    if (article.keyPoints && article.keyPoints.length > 0) {\n      article.keyPoints.forEach((point, index) => {\n        markdown += `${index + 1}. ${point}\\n`;\n      });\n    } else {\n      markdown += 'æš‚æ— æ ¸å¿ƒè§‚ç‚¹\\n';\n    }\n    \n    markdown += `\\n---\\n\\n`;\n    \n    // åŸæ–‡å†…å®¹\n    markdown += `## ğŸ“„ åŸæ–‡å†…å®¹\\n\\n`;\n    markdown += `${article.content || 'å†…å®¹ä¸å¯ç”¨'}\\n\\n`;\n    \n    markdown += `\\n---\\n\\n`;\n    markdown += `*æœ¬æ–‡ç”± Digest AI å¯¼å‡º*\\n`;\n    \n    // åˆ›å»ºä¸‹è½½é“¾æ¥\n    const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    \n    // ç”Ÿæˆæ–‡ä»¶åï¼ˆæ¸…ç†æ ‡é¢˜ä¸­çš„éæ³•å­—ç¬¦ï¼‰\n    const fileName = `${article.title.replace(/[<>:\"/\\\\|?*]/g, '_')}.md`;\n    link.href = url;\n    link.download = fileName;\n    \n    // è§¦å‘ä¸‹è½½\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    \n    // é‡Šæ”¾ URL\n    URL.revokeObjectURL(url);\n    \n    showSuccess('æ–‡ç« å·²å¯¼å‡ºä¸º Markdown');\n  } catch (error) {\n    console.error('å¯¼å‡ºå¤±è´¥:', error);\n    showError('å¯¼å‡ºå¤±è´¥: ' + error.message);\n  }\n}\n\n// äº‹ä»¶ç›‘å¬å™¨\n\n// æœç´¢\nelements.searchInput.addEventListener('input', (e) => {\n  searchArticles(e.target.value);\n});\n\n// æ ‡ç­¾ç­›é€‰\nelements.tagFilter.addEventListener('change', () => {\n  searchArticles(elements.searchInput.value);\n});\n\n// è®¾ç½®æŒ‰é’®\nelements.settingsBtn.addEventListener('click', () => {\n  chrome.tabs.create({ url: 'settings.html' });\n});\n\n// ä¸»é¢˜åˆ‡æ¢æŒ‰é’®\nelements.themeToggleBtn.addEventListener('click', async () => {\n  try {\n    // è·å–å½“å‰ä¸»é¢˜\n    const result = await chrome.storage.local.get(['theme']);\n    const currentTheme = result.theme || 'light';\n    \n    // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä¸»é¢˜\n    let newTheme;\n    if (currentTheme === 'light') {\n      newTheme = 'dark';\n      elements.themeToggleBtn.textContent = 'â˜€ï¸';\n      elements.themeToggleBtn.title = 'åˆ‡æ¢åˆ°æµ…è‰²ä¸»é¢˜';\n    } else {\n      newTheme = 'light';\n      elements.themeToggleBtn.textContent = 'ğŸŒ™';\n      elements.themeToggleBtn.title = 'åˆ‡æ¢åˆ°æ·±è‰²ä¸»é¢˜';\n    }\n    \n    // ä¿å­˜å¹¶åº”ç”¨æ–°ä¸»é¢˜\n    await chrome.storage.local.set({ theme: newTheme });\n    await applyTheme(newTheme);\n    \n    // æ˜¾ç¤ºæˆåŠŸæç¤º\n    showSuccess('ä¸»é¢˜å·²åˆ‡æ¢');\n  } catch (error) {\n    console.error('åˆ‡æ¢ä¸»é¢˜å¤±è´¥:', error);\n    showError('åˆ‡æ¢ä¸»é¢˜å¤±è´¥');\n  }\n});\n\n// æ‰“å¼€åŸæ–‡\nelements.openOriginalBtn.addEventListener('click', () => {\n  if (currentArticle) {\n    chrome.tabs.create({ url: currentArticle.url });\n  }\n});\n\n// å¯¼å‡ºä¸º Markdown\nelements.exportMarkdownBtn.addEventListener('click', () => {\n  if (currentArticle) {\n    exportToMarkdown(currentArticle);\n  }\n});\n\n// åˆ é™¤æ–‡ç« \nelements.deleteArticleBtn.addEventListener('click', deleteArticle);\n\n// æ·»åŠ æ ‡ç­¾\nelements.addTagBtn.addEventListener('click', openTagModal);\nelements.confirmTagBtn.addEventListener('click', () => {\n  const tag = elements.newTagInput.value;\n  addTag(tag);\n});\nelements.cancelTagBtn.addEventListener('click', closeTagModal);\n\n// æ ‡ç­¾è¾“å…¥ - Enter é”®\nelements.newTagInput.addEventListener('keypress', (e) => {\n  if (e.key === 'Enter') {\n    const tag = e.target.value;\n    addTag(tag);\n  }\n});\n\n// åˆ é™¤æ ‡ç­¾\nelements.articleTagsList.addEventListener('click', (e) => {\n  if (e.target.classList.contains('tag-remove')) {\n    const tag = e.target.dataset.tag;\n    removeTag(tag);\n  }\n});\n\n// æ¨¡æ€æ¡†èƒŒæ™¯ç‚¹å‡»å…³é—­\nelements.tagModal.addEventListener('click', (e) => {\n  if (e.target === elements.tagModal) {\n    closeTagModal();\n  }\n});\n\n/**\n * æ ¼å¼åŒ–æ—¶é•¿ï¼ˆç§’è½¬ä¸º HH:MM:SS æˆ– MM:SSï¼‰\n */\nfunction formatDuration(seconds) {\n  if (!seconds || seconds === 0) return '';\n  \n  const hours = Math.floor(seconds / 3600);\n  const minutes = Math.floor((seconds % 3600) / 60);\n  const secs = Math.floor(seconds % 60);\n  \n  if (hours > 0) {\n    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  }\n  return `${minutes}:${secs.toString().padStart(2, '0')}`;\n}\n\n// åˆå§‹åŒ–\n(async function init() {\n  await loadArticles();\n  \n  // åˆå§‹åŒ–ä¸»é¢˜æŒ‰é’®å›¾æ ‡\n  const result = await chrome.storage.local.get(['theme']);\n  const currentTheme = result.theme || 'light';\n  if (currentTheme === 'dark') {\n    elements.themeToggleBtn.textContent = 'â˜€ï¸';\n    elements.themeToggleBtn.title = 'åˆ‡æ¢åˆ°æµ…è‰²ä¸»é¢˜';\n  } else {\n    elements.themeToggleBtn.textContent = 'ğŸŒ™';\n    elements.themeToggleBtn.title = 'åˆ‡æ¢åˆ°æ·±è‰²ä¸»é¢˜';\n  }\n})();\n\n"],"names":[],"sourceRoot":""}