{"version":3,"file":"settings.js","mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://digest-ai-extension/./settings.js"],"sourcesContent":["/**\n * Settings é¡µé¢é€»è¾‘\n * å¤„ç†è®¾ç½®çš„ä¿å­˜å’ŒåŠ è½½\n */\n\n// DOM å…ƒç´ \nconst elements = {\n  // å¯¼èˆª\n  navItems: document.querySelectorAll('.nav-item'),\n  sections: document.querySelectorAll('.settings-section'),\n  \n  // åŸºæœ¬è®¾ç½®\n  themeSelect: document.getElementById('themeSelect'),\n  fontSizeSelect: document.getElementById('fontSizeSelect'),\n  \n  // äº‘åŒæ­¥ï¼ˆSupabaseï¼‰\n  sbUrlText: document.getElementById('sbUrlText'),\n  sbEmail: document.getElementById('sbEmail'),\n  sbPassword: document.getElementById('sbPassword'),\n  sbSignupBtn: document.getElementById('sbSignupBtn'),\n  sbLoginBtn: document.getElementById('sbLoginBtn'),\n  sbLogoutBtn: document.getElementById('sbLogoutBtn'),\n  sbUploadBtn: document.getElementById('sbUploadBtn'),\n  sbDownloadMergeBtn: document.getElementById('sbDownloadMergeBtn'),\n  sbDownloadOverwriteBtn: document.getElementById('sbDownloadOverwriteBtn'),\n  sbAuthStatus: document.getElementById('sbAuthStatus'),\n  sbSyncStatus: document.getElementById('sbSyncStatus'),\n  \n  // AI é…ç½®\n  aiModelSelect: document.getElementById('aiModelSelect'),\n  \n  // å„æ¨¡å‹çš„ API Key è¾“å…¥æ¡†\n  geminiApiKeyInput: document.getElementById('geminiApiKeyInput'),\n  openaiApiKeyInput: document.getElementById('openaiApiKeyInput'),\n  claudeApiKeyInput: document.getElementById('claudeApiKeyInput'),\n  deepseekApiKeyInput: document.getElementById('deepseekApiKeyInput'),\n  qwenApiKeyInput: document.getElementById('qwenApiKeyInput'),\n  \n  // API Key æ˜¾ç¤º/éšè—æŒ‰é’®ï¼ˆå¤šä¸ªï¼‰\n  toggleApiKeyButtons: document.querySelectorAll('.toggle-api-key'),\n  \n  // é«˜çº§è®¾ç½®\n  summaryLengthRange: document.getElementById('summaryLengthRange'),\n  summaryLengthValue: document.getElementById('summaryLengthValue'),\n  tagCountSelect: document.getElementById('tagCountSelect'),\n  enableAutoTagsCheckbox: document.getElementById('enableAutoTagsCheckbox'),\n  \n  // è‡ªå®šä¹‰æç¤ºè¯\n  enableCustomPromptCheckbox: document.getElementById('enableCustomPromptCheckbox'),\n  customPromptSection: document.getElementById('customPromptSection'),\n  customPromptInput: document.getElementById('customPromptInput'),\n  resetPromptBtn: document.getElementById('resetPromptBtn'),\n  \n  // å†…å®¹ä¿å­˜è®¾ç½®\n  saveOriginalContentCheckbox: document.getElementById('saveOriginalContentCheckbox'),\n  saveImagesCheckbox: document.getElementById('saveImagesCheckbox'),\n  enableFloatButtonCheckbox: document.getElementById('enableFloatButtonCheckbox'),\n  \n  // æŒ‰é’®\n  saveBasicSettingsBtn: document.getElementById('saveBasicSettingsBtn'),\n  saveSettingsBtn: document.getElementById('saveSettingsBtn'),\n  testConnectionBtn: document.getElementById('testConnectionBtn'),\n  backToDashboard: document.getElementById('backToDashboard'),\n  // åº•éƒ¨é“¾æ¥\n  viewDocs: document.getElementById('viewDocs'),\n  reportIssue: document.getElementById('reportIssue'),\n  visitGithub: document.getElementById('visitGithub'),\n  \n  // çŠ¶æ€æ¶ˆæ¯\n  statusMessage: document.getElementById('statusMessage')\n};\n\n/**\n * å¯¼èˆªåˆ‡æ¢\n */\nfunction switchSection(sectionId) {\n  // æ›´æ–°å¯¼èˆªçŠ¶æ€\n  elements.navItems.forEach(item => {\n    item.classList.remove('active');\n    if (item.dataset.section === sectionId) {\n      item.classList.add('active');\n    }\n  });\n  \n  // æ›´æ–°å†…å®¹æ˜¾ç¤º\n  elements.sections.forEach(section => {\n    section.classList.remove('active');\n    if (section.id === `${sectionId}-section`) {\n      section.classList.add('active');\n    }\n  });\n}\n\n// åˆå§‹åŒ–ä¾§è¾¹æ å¯¼èˆªï¼Œå¢åŠ äº‘åŒæ­¥èœå•é¡¹ï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰\n(function ensureCloudNav() {\n  const sidebarNav = document.querySelector('.nav-menu');\n  if (sidebarNav && !sidebarNav.querySelector('[data-section=\"cloud\"]')) {\n    const link = document.createElement('a');\n    link.href = '#cloud';\n    link.className = 'nav-item';\n    link.dataset.section = 'cloud';\n    link.innerHTML = '<span class=\"icon\">â˜ï¸</span><span>äº‘åŒæ­¥</span>';\n    sidebarNav.insertBefore(link, sidebarNav.querySelector('[data-section=\"about\"]'));\n    // ç»‘å®šäº‹ä»¶\n    link.addEventListener('click', (e) => {\n      e.preventDefault();\n      switchSection('cloud');\n    });\n  }\n})();\n\n/**\n * æ ¹æ®é€‰æ‹©çš„æ¨¡å‹å¯ç”¨/ç¦ç”¨æµ‹è¯•è¿æ¥æŒ‰é’®\n */\nfunction updateTestButtonState() {\n  const selectedModel = elements.aiModelSelect.value;\n  elements.testConnectionBtn.disabled = !selectedModel;\n}\n\n/**\n * é»˜è®¤æç¤ºè¯æ¨¡æ¿\n */\nconst DEFAULT_PROMPT_TEMPLATE = `è¯·åˆ†æä»¥ä¸‹æ–‡ç« å†…å®¹ï¼Œç”Ÿæˆä¸€ä¸ªçº¦ {{SUMMARY_LENGTH}} å­—çš„ç®€æ´ä¸­æ–‡æ‘˜è¦ã€{{TAG_COUNT}} ä¸ªæ ¸å¿ƒè§‚ç‚¹å’Œ {{TAG_COUNT}} ä¸ªç›¸å…³æ ‡ç­¾ã€‚\n\nè¯·æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼è¿”å›ç»“æœï¼š\n{\n  \"summary\": \"æ–‡ç« æ‘˜è¦å†…å®¹...\",\n  \"keyPoints\": [\n    \"æ ¸å¿ƒè§‚ç‚¹1\",\n    \"æ ¸å¿ƒè§‚ç‚¹2\",\n    \"æ ¸å¿ƒè§‚ç‚¹3\"\n  ],\n  \"tags\": [\n    \"æ ‡ç­¾1\",\n    \"æ ‡ç­¾2\",\n    \"æ ‡ç­¾3\"\n  ]\n}\n\næ–‡ç« å†…å®¹ï¼š\n{{TEXT}}\n\nè¯·ç›´æ¥è¿”å› JSON æ ¼å¼çš„ç»“æœï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—ã€‚`;\n\n/**\n * åŠ è½½è®¾ç½®\n */\nasync function loadSettings() {\n  try {\n    const settings = await chrome.storage.local.get([\n      'theme',\n      'fontSize',\n      'aiModel',\n      // æ—§ç‰ˆæœ¬çš„å•ä¸€ apiKeyï¼ˆç”¨äºå‘åå…¼å®¹ï¼‰\n      'apiKey',\n      // æ–°ç‰ˆæœ¬çš„å¤šæ¨¡å‹ API Keys\n      'geminiApiKey',\n      'openaiApiKey',\n      'claudeApiKey',\n      'deepseekApiKey',\n      'qwenApiKey',\n      'summaryLength',\n      'tagCount',\n      'enableAutoTags',\n      'enableCustomPrompt',\n      'customPrompt',\n      'saveOriginalContent',\n      'saveImages',\n      'enableFloatButton'\n    ]);\n    \n    // åŸºæœ¬è®¾ç½®\n    if (settings.theme) {\n      elements.themeSelect.value = settings.theme;\n    }\n    \n    if (settings.fontSize) {\n      elements.fontSizeSelect.value = settings.fontSize;\n    }\n    \n    // AI é…ç½®\n    if (settings.aiModel) {\n      elements.aiModelSelect.value = settings.aiModel;\n      updateTestButtonState();\n    }\n    \n    // åŠ è½½å„æ¨¡å‹çš„ API Key\n    if (settings.geminiApiKey) {\n      elements.geminiApiKeyInput.value = settings.geminiApiKey;\n    }\n    if (settings.openaiApiKey) {\n      elements.openaiApiKeyInput.value = settings.openaiApiKey;\n    }\n    if (settings.claudeApiKey) {\n      elements.claudeApiKeyInput.value = settings.claudeApiKey;\n    }\n    if (settings.deepseekApiKey) {\n      elements.deepseekApiKeyInput.value = settings.deepseekApiKey;\n    }\n    if (settings.qwenApiKey) {\n      elements.qwenApiKeyInput.value = settings.qwenApiKey;\n    }\n    \n    // å‘åå…¼å®¹ï¼šå¦‚æœæœ‰æ—§çš„ apiKey ä¸”å¯¹åº”æ¨¡å‹çš„æ–° key ä¸å­˜åœ¨ï¼Œè¿ç§»æ•°æ®\n    if (settings.apiKey && settings.aiModel) {\n      const keyMap = {\n        'gemini': 'geminiApiKey',\n        'openai': 'openaiApiKey',\n        'claude': 'claudeApiKey',\n        'deepseek': 'deepseekApiKey',\n        'qwen': 'qwenApiKey'\n      };\n      \n      const newKeyName = keyMap[settings.aiModel];\n      if (newKeyName && !settings[newKeyName]) {\n        // è¿ç§»æ—§ key åˆ°å¯¹åº”çš„æ–° key\n        const migrationData = {};\n        migrationData[newKeyName] = settings.apiKey;\n        await chrome.storage.local.set(migrationData);\n        \n        // æ›´æ–° UI\n        const inputElement = elements[`${settings.aiModel}ApiKeyInput`];\n        if (inputElement) {\n          inputElement.value = settings.apiKey;\n        }\n        \n        console.log(`å·²è¿ç§» API Key: ${settings.aiModel} -> ${newKeyName}`);\n      }\n    }\n    \n    // é«˜çº§è®¾ç½®\n    const summaryLength = settings.summaryLength || 200;\n    elements.summaryLengthRange.value = summaryLength;\n    elements.summaryLengthValue.textContent = summaryLength;\n    \n    const tagCount = settings.tagCount || 3;\n    elements.tagCountSelect.value = tagCount;\n    \n    const enableAutoTags = settings.enableAutoTags !== undefined ? settings.enableAutoTags : true;\n    elements.enableAutoTagsCheckbox.checked = enableAutoTags;\n    \n    // è‡ªå®šä¹‰æç¤ºè¯\n    const enableCustomPrompt = settings.enableCustomPrompt || false;\n    elements.enableCustomPromptCheckbox.checked = enableCustomPrompt;\n    \n    const customPrompt = settings.customPrompt || DEFAULT_PROMPT_TEMPLATE;\n    elements.customPromptInput.value = customPrompt;\n    \n    // å†…å®¹ä¿å­˜è®¾ç½®\n    const saveOriginalContent = settings.saveOriginalContent !== undefined ? settings.saveOriginalContent : true;\n    elements.saveOriginalContentCheckbox.checked = saveOriginalContent;\n    \n    const saveImages = settings.saveImages !== undefined ? settings.saveImages : true;\n    elements.saveImagesCheckbox.checked = saveImages;\n    \n    const enableFloatButton = settings.enableFloatButton !== undefined ? settings.enableFloatButton : true;\n    elements.enableFloatButtonCheckbox.checked = enableFloatButton;\n    \n    // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰æç¤ºè¯åŒºåŸŸ\n    if (enableCustomPrompt) {\n      elements.customPromptSection.classList.remove('hidden');\n    } else {\n      elements.customPromptSection.classList.add('hidden');\n    }\n    \n    // æ³¨æ„ï¼šä¸»é¢˜å’Œå­—ä½“ä¼šåœ¨ settings.html çš„è„šæœ¬ä¸­é€šè¿‡ loadSavedTheme() å’Œ loadSavedFontSize() åº”ç”¨\n    // è¿™é‡Œä¸éœ€è¦é‡å¤åº”ç”¨ï¼Œé¿å…å†²çª\n  } catch (error) {\n    console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);\n  }\n}\n\n/**\n * äº‘åŒæ­¥ - UI çŠ¶æ€\n */\nasync function refreshSupabaseUI() {\n  try {\n    if (elements.sbUrlText && window.SupabaseSync?.constants?.url) {\n      elements.sbUrlText.textContent = window.SupabaseSync.constants.url;\n    }\n    const user = await window.SupabaseSync.getCurrentUser().catch(() => null);\n    if (user && user.email) {\n      elements.sbAuthStatus.textContent = `å·²ç™»å½•ï¼š${user.email}`;\n    } else {\n      elements.sbAuthStatus.textContent = 'æœªç™»å½•';\n    }\n  } catch (e) {\n    elements.sbAuthStatus.textContent = 'çŠ¶æ€è·å–å¤±è´¥';\n  }\n}\n\n/**\n * äº‘åŒæ­¥ - äº‹ä»¶å¤„ç†\n */\nasync function sbSignup() {\n  try {\n    const email = elements.sbEmail.value.trim();\n    const password = elements.sbPassword.value;\n    if (!email || !password) {\n      showStatus('è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ', 'error');\n      return;\n    }\n    await window.SupabaseSync.signup(email, password);\n    showStatus('æ³¨å†ŒæˆåŠŸï¼Œå¦‚éœ€é‚®ä»¶éªŒè¯è¯·å‰å¾€é‚®ç®±ç¡®è®¤', 'success');\n    await refreshSupabaseUI();\n  } catch (e) {\n    showStatus(`æ³¨å†Œå¤±è´¥ï¼š${e.message}`, 'error');\n  }\n}\n\nasync function sbLogin() {\n  try {\n    const email = elements.sbEmail.value.trim();\n    const password = elements.sbPassword.value;\n    if (!email || !password) {\n      showStatus('è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ', 'error');\n      return;\n    }\n    await window.SupabaseSync.login(email, password);\n    showStatus('ç™»å½•æˆåŠŸ', 'success');\n    await refreshSupabaseUI();\n  } catch (e) {\n    showStatus(`ç™»å½•å¤±è´¥ï¼š${e.message}`, 'error');\n  }\n}\n\nasync function sbLogout() {\n  try {\n    await window.SupabaseSync.logout();\n    showStatus('å·²é€€å‡ºç™»å½•', 'success');\n    await refreshSupabaseUI();\n  } catch (e) {\n    showStatus(`é€€å‡ºå¤±è´¥ï¼š${e.message}`, 'error');\n  }\n}\n\nasync function sbUpload() {\n  try {\n    elements.sbSyncStatus.textContent = 'æ­£åœ¨ä¸Šä¼ ...';\n    const result = await window.SupabaseSync.uploadArticles();\n    elements.sbSyncStatus.textContent = `ä¸Šä¼ å®Œæˆï¼š${result.inserted} ç¯‡`;\n    showStatus('ä¸Šä¼ å®Œæˆ', 'success');\n  } catch (e) {\n    elements.sbSyncStatus.textContent = `ä¸Šä¼ å¤±è´¥ï¼š${e.message}`;\n    showStatus(`ä¸Šä¼ å¤±è´¥ï¼š${e.message}`, 'error');\n  }\n}\n\nasync function sbDownloadMerge() {\n  try {\n    elements.sbSyncStatus.textContent = 'æ­£åœ¨ä¸‹è½½å¹¶åˆå¹¶...';\n    const result = await window.SupabaseSync.downloadArticles({ overwrite: false });\n    elements.sbSyncStatus.textContent = `ä¸‹è½½å®Œæˆï¼š${result.downloaded} ç¯‡ï¼ˆå·²åˆå¹¶ï¼‰`;\n    showStatus('ä¸‹è½½å®Œæˆï¼ˆå·²åˆå¹¶ï¼‰', 'success');\n  } catch (e) {\n    elements.sbSyncStatus.textContent = `ä¸‹è½½å¤±è´¥ï¼š${e.message}`;\n    showStatus(`ä¸‹è½½å¤±è´¥ï¼š${e.message}`, 'error');\n  }\n}\n\nasync function sbDownloadOverwrite() {\n  try {\n    elements.sbSyncStatus.textContent = 'æ­£åœ¨ä¸‹è½½å¹¶è¦†ç›–æœ¬åœ°...';\n    const result = await window.SupabaseSync.downloadArticles({ overwrite: true });\n    elements.sbSyncStatus.textContent = `ä¸‹è½½å®Œæˆï¼š${result.downloaded} ç¯‡ï¼ˆå·²è¦†ç›–æœ¬åœ°ï¼‰`;\n    showStatus('ä¸‹è½½å®Œæˆï¼ˆå·²è¦†ç›–æœ¬åœ°ï¼‰', 'success');\n  } catch (e) {\n    elements.sbSyncStatus.textContent = `ä¸‹è½½å¤±è´¥ï¼š${e.message}`;\n    showStatus(`ä¸‹è½½å¤±è´¥ï¼š${e.message}`, 'error');\n  }\n}\n\n/**\n * ä¿å­˜åŸºæœ¬è®¾ç½®ï¼ˆä¸»é¢˜å’Œå­—ä½“ï¼‰\n */\nasync function saveBasicSettings() {\n  try {\n    const theme = elements.themeSelect.value;\n    const fontSize = elements.fontSizeSelect.value;\n    \n    // å…ˆåº”ç”¨å¹¶ä¿å­˜ä¸»é¢˜\n    if (window.applyTheme) {\n      await window.applyTheme(theme, true); // æ˜ç¡®ä¿å­˜åˆ° storage\n    }\n    \n    // ä¿å­˜å­—ä½“å¤§å°\n    if (window.applyFontSize) {\n      await window.applyFontSize(fontSize, true); // æ˜ç¡®ä¿å­˜åˆ° storage\n    }\n    \n    showStatus('åŸºæœ¬è®¾ç½®å·²ä¿å­˜ï¼', 'success');\n  } catch (error) {\n    console.error('ä¿å­˜åŸºæœ¬è®¾ç½®å¤±è´¥:', error);\n    showStatus('ä¿å­˜å¤±è´¥: ' + error.message, 'error');\n  }\n}\n\n/**\n * ä¿å­˜ AI è®¾ç½®\n */\nasync function saveSettings() {\n  try {\n    const settings = {\n      theme: elements.themeSelect.value,\n      fontSize: elements.fontSizeSelect.value,\n      aiModel: elements.aiModelSelect.value,\n      // ä¿å­˜å„æ¨¡å‹çš„ API Key\n      geminiApiKey: elements.geminiApiKeyInput.value.trim(),\n      openaiApiKey: elements.openaiApiKeyInput.value.trim(),\n      claudeApiKey: elements.claudeApiKeyInput.value.trim(),\n      deepseekApiKey: elements.deepseekApiKeyInput.value.trim(),\n      qwenApiKey: elements.qwenApiKeyInput.value.trim(),\n      summaryLength: parseInt(elements.summaryLengthRange.value),\n      tagCount: parseInt(elements.tagCountSelect.value),\n      enableAutoTags: elements.enableAutoTagsCheckbox.checked,\n      enableCustomPrompt: elements.enableCustomPromptCheckbox.checked,\n      customPrompt: elements.customPromptInput.value.trim() || DEFAULT_PROMPT_TEMPLATE,\n      saveOriginalContent: elements.saveOriginalContentCheckbox.checked,\n      saveImages: elements.saveImagesCheckbox.checked,\n      enableFloatButton: elements.enableFloatButtonCheckbox.checked\n    };\n    \n    // éªŒè¯å¿…è¦å­—æ®µï¼šå¦‚æœé€‰æ‹©äº†æ¨¡å‹ï¼Œæ£€æŸ¥å¯¹åº”çš„ API Key æ˜¯å¦å·²é…ç½®\n    if (settings.aiModel) {\n      const keyMap = {\n        'gemini': settings.geminiApiKey,\n        'openai': settings.openaiApiKey,\n        'claude': settings.claudeApiKey,\n        'deepseek': settings.deepseekApiKey,\n        'qwen': settings.qwenApiKey\n      };\n      \n      if (!keyMap[settings.aiModel]) {\n        const modelNames = {\n          'gemini': 'Google Gemini',\n          'openai': 'OpenAI',\n          'claude': 'Anthropic Claude',\n          'deepseek': 'DeepSeek',\n          'qwen': 'é€šä¹‰åƒé—®'\n        };\n        showStatus(`è¯·å…ˆé…ç½® ${modelNames[settings.aiModel]} çš„ API Key`, 'error');\n        return;\n      }\n    }\n    \n    // éªŒè¯è‡ªå®šä¹‰æç¤ºè¯\n    if (settings.enableCustomPrompt && settings.customPrompt) {\n      if (!settings.customPrompt.includes('{{TEXT}}')) {\n        showStatus('è‡ªå®šä¹‰æç¤ºè¯å¿…é¡»åŒ…å« {{TEXT}} å˜é‡', 'error');\n        return;\n      }\n    }\n    \n    // ä¿å­˜åˆ°å­˜å‚¨\n    await chrome.storage.local.set(settings);\n    \n    showStatus('è®¾ç½®å·²ä¿å­˜ï¼', 'success');\n  } catch (error) {\n    console.error('ä¿å­˜è®¾ç½®å¤±è´¥:', error);\n    showStatus('ä¿å­˜å¤±è´¥: ' + error.message, 'error');\n  }\n}\n\n/**\n * æµ‹è¯• API è¿æ¥\n */\nasync function testConnection() {\n  const apiModel = elements.aiModelSelect.value;\n  \n  if (!apiModel) {\n    showStatus('è¯·å…ˆé€‰æ‹© AI æ¨¡å‹', 'error');\n    return;\n  }\n  \n  // è·å–å¯¹åº”æ¨¡å‹çš„ API Key\n  const keyMap = {\n    'gemini': elements.geminiApiKeyInput.value.trim(),\n    'openai': elements.openaiApiKeyInput.value.trim(),\n    'claude': elements.claudeApiKeyInput.value.trim(),\n    'deepseek': elements.deepseekApiKeyInput.value.trim(),\n    'qwen': elements.qwenApiKeyInput.value.trim()\n  };\n  \n  const apiKey = keyMap[apiModel];\n  \n  if (!apiKey) {\n    const modelNames = {\n      'gemini': 'Google Gemini',\n      'openai': 'OpenAI',\n      'claude': 'Anthropic Claude',\n      'deepseek': 'DeepSeek',\n      'qwen': 'é€šä¹‰åƒé—®'\n    };\n    showStatus(`è¯·å…ˆè¾“å…¥ ${modelNames[apiModel]} çš„ API Key`, 'error');\n    return;\n  }\n  \n  showStatus('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'info');\n  elements.testConnectionBtn.disabled = true;\n  \n  try {\n    // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„ API æµ‹è¯•\n    // æš‚æ—¶ä½¿ç”¨ç®€å•çš„éªŒè¯\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    showStatus('âœ… è¿æ¥æˆåŠŸï¼API Key æœ‰æ•ˆ', 'success');\n  } catch (error) {\n    showStatus('âŒ è¿æ¥å¤±è´¥: ' + error.message, 'error');\n  } finally {\n    elements.testConnectionBtn.disabled = false;\n  }\n}\n\n/**\n * æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯\n */\nfunction showStatus(message, type = 'success') {\n  elements.statusMessage.textContent = message;\n  elements.statusMessage.className = `status-message ${type}`;\n  elements.statusMessage.classList.remove('hidden');\n  \n  // 3ç§’åè‡ªåŠ¨éšè—ï¼ˆé™¤äº†é”™è¯¯æ¶ˆæ¯ï¼‰\n  if (type !== 'error') {\n    setTimeout(() => {\n      elements.statusMessage.classList.add('hidden');\n    }, 3000);\n  }\n}\n\n/**\n * åˆ‡æ¢ API Key æ˜¾ç¤º/éšè—ï¼ˆé€šç”¨å‡½æ•°ï¼‰\n */\nfunction toggleApiKeyVisibility(button) {\n  const targetId = button.dataset.target;\n  const input = document.getElementById(targetId);\n  \n  if (input) {\n    const type = input.type;\n    input.type = type === 'password' ? 'text' : 'password';\n    button.textContent = type === 'password' ? 'ğŸ™ˆ' : 'ğŸ‘ï¸';\n  }\n}\n\n// äº‹ä»¶ç›‘å¬å™¨\n\n// å¯¼èˆªåˆ‡æ¢\nelements.navItems.forEach(item => {\n  item.addEventListener('click', (e) => {\n    e.preventDefault();\n    const sectionId = item.dataset.section;\n    switchSection(sectionId);\n  });\n});\n\n// AI æ¨¡å‹é€‰æ‹©\nelements.aiModelSelect.addEventListener('change', (e) => {\n  updateTestButtonState();\n});\n\n// æŒ‰é’®äº‹ä»¶\nelements.saveBasicSettingsBtn.addEventListener('click', saveBasicSettings);\nelements.saveSettingsBtn.addEventListener('click', saveSettings);\nelements.testConnectionBtn.addEventListener('click', testConnection);\nelements.backToDashboard.addEventListener('click', () => {\n  chrome.tabs.create({ url: 'dashboard.html' });\n});\n// å¤–éƒ¨é“¾æ¥\nif (elements.viewDocs) {\n  elements.viewDocs.addEventListener('click', (e) => {\n    e.preventDefault();\n    chrome.tabs.create({ url: 'https://github.com/MitsuhaFe/Digest-AI#readme' });\n  });\n}\nif (elements.reportIssue) {\n  elements.reportIssue.addEventListener('click', (e) => {\n    e.preventDefault();\n    chrome.tabs.create({ url: 'https://github.com/MitsuhaFe/Digest-AI/issues/new/choose' });\n  });\n}\nif (elements.visitGithub) {\n  elements.visitGithub.addEventListener('click', (e) => {\n    e.preventDefault();\n    chrome.tabs.create({ url: 'https://github.com/MitsuhaFe/Digest-AI' });\n  });\n}\n// äº‘åŒæ­¥æŒ‰é’®\nif (elements.sbSignupBtn) elements.sbSignupBtn.addEventListener('click', sbSignup);\nif (elements.sbLoginBtn) elements.sbLoginBtn.addEventListener('click', sbLogin);\nif (elements.sbLogoutBtn) elements.sbLogoutBtn.addEventListener('click', sbLogout);\nif (elements.sbUploadBtn) elements.sbUploadBtn.addEventListener('click', sbUpload);\nif (elements.sbDownloadMergeBtn) elements.sbDownloadMergeBtn.addEventListener('click', sbDownloadMerge);\nif (elements.sbDownloadOverwriteBtn) elements.sbDownloadOverwriteBtn.addEventListener('click', sbDownloadOverwrite);\n\n// API Key æ˜¾ç¤º/éšè—æŒ‰é’®ï¼ˆå¤šä¸ªï¼‰\nelements.toggleApiKeyButtons.forEach(button => {\n  button.addEventListener('click', () => {\n    toggleApiKeyVisibility(button);\n  });\n});\n\n// ä¸»é¢˜åˆ‡æ¢ - ç«‹å³é¢„è§ˆï¼ˆä¸ä¿å­˜ï¼‰\nelements.themeSelect.addEventListener('change', (e) => {\n  const theme = e.target.value;\n  if (window.applyThemeStyles) {\n    window.applyThemeStyles(theme);\n    showStatus('ä¸»é¢˜å·²é¢„è§ˆï¼Œè¯·ç‚¹å‡»\"ä¿å­˜åŸºæœ¬è®¾ç½®\"ä¿å­˜æ›´æ”¹', 'info');\n  } else {\n    console.error('applyThemeStyles å‡½æ•°æœªæ‰¾åˆ°');\n  }\n});\n\n// å­—ä½“å¤§å°åˆ‡æ¢ - ç«‹å³é¢„è§ˆï¼ˆä¸ä¿å­˜ï¼‰\nelements.fontSizeSelect.addEventListener('change', (e) => {\n  const fontSize = e.target.value;\n  if (window.applyFontSizeStyles) {\n    window.applyFontSizeStyles(fontSize);\n    showStatus('å­—ä½“å·²é¢„è§ˆï¼Œè¯·ç‚¹å‡»\"ä¿å­˜åŸºæœ¬è®¾ç½®\"ä¿å­˜æ›´æ”¹', 'info');\n  } else {\n    console.error('applyFontSizeStyles å‡½æ•°æœªæ‰¾åˆ°');\n  }\n});\n\n// æ‘˜è¦å­—æ•°èŒƒå›´æ»‘å—\nelements.summaryLengthRange.addEventListener('input', (e) => {\n  elements.summaryLengthValue.textContent = e.target.value;\n});\n\n// è‡ªå®šä¹‰æç¤ºè¯å¼€å…³\nelements.enableCustomPromptCheckbox.addEventListener('change', (e) => {\n  if (e.target.checked) {\n    elements.customPromptSection.classList.remove('hidden');\n  } else {\n    elements.customPromptSection.classList.add('hidden');\n  }\n});\n\n// æ¢å¤é»˜è®¤æç¤ºè¯\nelements.resetPromptBtn.addEventListener('click', () => {\n  elements.customPromptInput.value = DEFAULT_PROMPT_TEMPLATE;\n  showStatus('å·²æ¢å¤é»˜è®¤æç¤ºè¯', 'success');\n});\n\n// åˆå§‹åŒ–\n(function init() {\n  // åº”ç”¨å·²ä¿å­˜çš„ä¸»é¢˜/å­—ä½“ï¼Œå¹¶ç›‘å¬ç³»ç»Ÿä¸»é¢˜ï¼ˆé¿å… settings.html å†…è”è„šæœ¬è§¦å‘ CSPï¼‰\n  if (typeof loadSavedTheme === 'function') {\n    loadSavedTheme().catch(() => {});\n  }\n  if (typeof loadSavedFontSize === 'function') {\n    loadSavedFontSize().catch(() => {});\n  }\n  if (typeof watchSystemTheme === 'function') {\n    try { watchSystemTheme(); } catch (e) {}\n  }\n  loadSettings();\n  refreshSupabaseUI();\n})();\n\n"],"names":[],"sourceRoot":""}