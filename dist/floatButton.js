(()=>{const t=new class{constructor(){this.button=null,this.isDragging=!1,this.startX=0,this.startY=0,this.offsetX=0,this.offsetY=0,this.enabled=!0}async init(){const t=await chrome.storage.local.get(["enableFloatButton"]);this.enabled=void 0===t.enableFloatButton||t.enableFloatButton,this.enabled?(this.remove(),this.button=document.createElement("div"),this.button.id="digest-ai-float-button",this.button.innerHTML='\n      <div class="float-btn-icon">üìö</div>\n      <div class="float-btn-tooltip">‰øùÂ≠òÊñáÁ´†</div>\n    ',this.injectStyles(),document.body.appendChild(this.button),this.bindEvents(),await this.loadPosition()):this.remove()}injectStyles(){if(document.getElementById("digest-ai-float-styles"))return;const t=document.createElement("style");t.id="digest-ai-float-styles",t.textContent="\n      #digest-ai-float-button {\n        position: fixed;\n        right: 20px;\n        bottom: 100px;\n        width: 56px;\n        height: 56px;\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        border-radius: 50%;\n        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n        cursor: pointer;\n        z-index: 999999;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        user-select: none;\n      }\n      \n      #digest-ai-float-button:hover {\n        transform: scale(1.1);\n        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);\n      }\n      \n      #digest-ai-float-button:active {\n        transform: scale(0.95);\n      }\n      \n      #digest-ai-float-button.dragging {\n        cursor: grabbing;\n        opacity: 0.8;\n      }\n      \n      .float-btn-icon {\n        font-size: 24px;\n        line-height: 1;\n      }\n      \n      .float-btn-tooltip {\n        position: absolute;\n        right: 70px;\n        background: rgba(0, 0, 0, 0.8);\n        color: white;\n        padding: 6px 12px;\n        border-radius: 6px;\n        font-size: 13px;\n        white-space: nowrap;\n        opacity: 0;\n        pointer-events: none;\n        transition: opacity 0.2s;\n      }\n      \n      #digest-ai-float-button:hover .float-btn-tooltip {\n        opacity: 1;\n      }\n      \n      .float-btn-tooltip::after {\n        content: '';\n        position: absolute;\n        right: -6px;\n        top: 50%;\n        transform: translateY(-50%);\n        border: 6px solid transparent;\n        border-left-color: rgba(0, 0, 0, 0.8);\n      }\n      \n      #digest-ai-float-button.saving {\n        animation: pulse 1s ease-in-out infinite;\n      }\n      \n      @keyframes pulse {\n        0%, 100% {\n          transform: scale(1);\n        }\n        50% {\n          transform: scale(1.05);\n        }\n      }\n    ",document.head.appendChild(t)}bindEvents(){this.button&&(this.button.addEventListener("mousedown",this.handleMouseDown.bind(this)),document.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.button.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),document.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.handleTouchEnd.bind(this)))}handleMouseDown(t){if(0!==t.button)return;this.isDragging=!0,this.button.classList.add("dragging");const n=this.button.getBoundingClientRect();this.offsetX=t.clientX-n.left,this.offsetY=t.clientY-n.top,this.startX=t.clientX,this.startY=t.clientY,t.preventDefault()}handleMouseMove(t){if(!this.isDragging)return;const n=t.clientX-this.offsetX,e=t.clientY-this.offsetY;this.updatePosition(n,e),t.preventDefault()}handleMouseUp(t){this.isDragging&&(this.isDragging=!1,this.button.classList.remove("dragging"),Math.sqrt(Math.pow(t.clientX-this.startX,2)+Math.pow(t.clientY-this.startY,2))<5?this.handleClick():this.savePosition())}handleTouchStart(t){if(1!==t.touches.length)return;this.isDragging=!0,this.button.classList.add("dragging");const n=t.touches[0],e=this.button.getBoundingClientRect();this.offsetX=n.clientX-e.left,this.offsetY=n.clientY-e.top,this.startX=n.clientX,this.startY=n.clientY,t.preventDefault()}handleTouchMove(t){if(!this.isDragging||1!==t.touches.length)return;const n=t.touches[0],e=n.clientX-this.offsetX,i=n.clientY-this.offsetY;this.updatePosition(e,i),t.preventDefault()}handleTouchEnd(t){if(!this.isDragging)return;this.isDragging=!1,this.button.classList.remove("dragging");const n=t.changedTouches[0];Math.sqrt(Math.pow(n.clientX-this.startX,2)+Math.pow(n.clientY-this.startY,2))<5?this.handleClick():this.savePosition()}updatePosition(t,n){if(!this.button)return;const e=window.innerWidth-this.button.offsetWidth,i=window.innerHeight-this.button.offsetHeight;t=Math.max(0,Math.min(t,e)),n=Math.max(0,Math.min(n,i)),this.button.style.left=`${t}px`,this.button.style.top=`${n}px`,this.button.style.right="auto",this.button.style.bottom="auto"}async handleClick(){if(this.button){this.button.classList.add("saving");try{const t=await chrome.runtime.sendMessage({action:"saveArticle",url:window.location.href,title:document.title});if(!t.success)throw new Error(t.error||"‰øùÂ≠òÂ§±Ë¥•");this.showToast("‚úÖ ÊñáÁ´†Â∑≤‰øùÂ≠ò","success")}catch(t){console.error("‰øùÂ≠òÊñáÁ´†Â§±Ë¥•:",t),this.showToast("‚ùå "+t.message,"error")}finally{this.button.classList.remove("saving")}}}showToast(t,n="info"){const e=document.getElementById("digest-ai-toast");e&&e.remove();const i=document.createElement("div");if(i.id="digest-ai-toast",i.textContent=t,i.className=`digest-ai-toast ${n}`,!document.getElementById("digest-ai-toast-styles")){const t=document.createElement("style");t.id="digest-ai-toast-styles",t.textContent="\n        .digest-ai-toast {\n          position: fixed;\n          top: 20px;\n          left: 50%;\n          transform: translateX(-50%);\n          background: rgba(0, 0, 0, 0.9);\n          color: white;\n          padding: 12px 24px;\n          border-radius: 8px;\n          font-size: 14px;\n          z-index: 1000000;\n          animation: slideDown 0.3s ease-out;\n        }\n        \n        .digest-ai-toast.success {\n          background: linear-gradient(135deg, #10b981 0%, #059669 100%);\n        }\n        \n        .digest-ai-toast.error {\n          background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n        }\n        \n        @keyframes slideDown {\n          from {\n            opacity: 0;\n            transform: translateX(-50%) translateY(-20px);\n          }\n          to {\n            opacity: 1;\n            transform: translateX(-50%) translateY(0);\n          }\n        }\n      ",document.head.appendChild(t)}document.body.appendChild(i),setTimeout(()=>{i.style.animation="slideDown 0.3s ease-out reverse",setTimeout(()=>i.remove(),300)},3e3)}async savePosition(){if(!this.button)return;const t={left:this.button.style.left,top:this.button.style.top};await chrome.storage.local.set({floatButtonPosition:t})}async loadPosition(){if(!this.button)return;const{floatButtonPosition:t}=await chrome.storage.local.get(["floatButtonPosition"]);t&&t.left&&t.top&&(this.button.style.left=t.left,this.button.style.top=t.top,this.button.style.right="auto",this.button.style.bottom="auto")}remove(){this.button&&(this.button.remove(),this.button=null)}async updateState(){const t=await chrome.storage.local.get(["enableFloatButton"]),n=void 0===t.enableFloatButton||t.enableFloatButton;n!==this.enabled&&(this.enabled=n,n?await this.init():this.remove())}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t.init()):t.init(),chrome.storage.onChanged.addListener((n,e)=>{"local"===e&&n.enableFloatButton&&t.updateState()}),"undefined"!=typeof window&&(window.digestAIFloatButton=t)})();