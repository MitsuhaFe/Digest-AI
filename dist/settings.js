(()=>{const e={navItems:document.querySelectorAll(".nav-item"),sections:document.querySelectorAll(".settings-section"),themeSelect:document.getElementById("themeSelect"),fontSizeSelect:document.getElementById("fontSizeSelect"),aiModelSelect:document.getElementById("aiModelSelect"),geminiApiKeyInput:document.getElementById("geminiApiKeyInput"),openaiApiKeyInput:document.getElementById("openaiApiKeyInput"),claudeApiKeyInput:document.getElementById("claudeApiKeyInput"),deepseekApiKeyInput:document.getElementById("deepseekApiKeyInput"),qwenApiKeyInput:document.getElementById("qwenApiKeyInput"),toggleApiKeyButtons:document.querySelectorAll(".toggle-api-key"),summaryLengthRange:document.getElementById("summaryLengthRange"),summaryLengthValue:document.getElementById("summaryLengthValue"),tagCountSelect:document.getElementById("tagCountSelect"),enableAutoTagsCheckbox:document.getElementById("enableAutoTagsCheckbox"),enableCustomPromptCheckbox:document.getElementById("enableCustomPromptCheckbox"),customPromptSection:document.getElementById("customPromptSection"),customPromptInput:document.getElementById("customPromptInput"),resetPromptBtn:document.getElementById("resetPromptBtn"),saveOriginalContentCheckbox:document.getElementById("saveOriginalContentCheckbox"),saveImagesCheckbox:document.getElementById("saveImagesCheckbox"),enableFloatButtonCheckbox:document.getElementById("enableFloatButtonCheckbox"),saveBasicSettingsBtn:document.getElementById("saveBasicSettingsBtn"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),testConnectionBtn:document.getElementById("testConnectionBtn"),backToDashboard:document.getElementById("backToDashboard"),statusMessage:document.getElementById("statusMessage")};function t(){const t=e.aiModelSelect.value;e.testConnectionBtn.disabled=!t}const n='è¯·åˆ†æžä»¥ä¸‹æ–‡ç« å†…å®¹ï¼Œç”Ÿæˆä¸€ä¸ªçº¦ {{SUMMARY_LENGTH}} å­—çš„ç®€æ´ä¸­æ–‡æ‘˜è¦ã€{{TAG_COUNT}} ä¸ªæ ¸å¿ƒè§‚ç‚¹å’Œ {{TAG_COUNT}} ä¸ªç›¸å…³æ ‡ç­¾ã€‚\n\nè¯·æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼è¿”å›žç»“æžœï¼š\n{\n  "summary": "æ–‡ç« æ‘˜è¦å†…å®¹...",\n  "keyPoints": [\n    "æ ¸å¿ƒè§‚ç‚¹1",\n    "æ ¸å¿ƒè§‚ç‚¹2",\n    "æ ¸å¿ƒè§‚ç‚¹3"\n  ],\n  "tags": [\n    "æ ‡ç­¾1",\n    "æ ‡ç­¾2",\n    "æ ‡ç­¾3"\n  ]\n}\n\næ–‡ç« å†…å®¹ï¼š\n{{TEXT}}\n\nè¯·ç›´æŽ¥è¿”å›ž JSON æ ¼å¼çš„ç»“æžœï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—ã€‚';function a(t,n="success"){e.statusMessage.textContent=t,e.statusMessage.className=`status-message ${n}`,e.statusMessage.classList.remove("hidden"),"error"!==n&&setTimeout(()=>{e.statusMessage.classList.add("hidden")},3e3)}e.navItems.forEach(t=>{t.addEventListener("click",n=>{var a;n.preventDefault(),a=t.dataset.section,e.navItems.forEach(e=>{e.classList.remove("active"),e.dataset.section===a&&e.classList.add("active")}),e.sections.forEach(e=>{e.classList.remove("active"),e.id===`${a}-section`&&e.classList.add("active")})})}),e.aiModelSelect.addEventListener("change",e=>{t()}),e.saveBasicSettingsBtn.addEventListener("click",async function(){try{const t=e.themeSelect.value,n=e.fontSizeSelect.value;window.applyTheme&&await window.applyTheme(t,!0),window.applyFontSize&&await window.applyFontSize(n,!0),a("åŸºæœ¬è®¾ç½®å·²ä¿å­˜ï¼","success")}catch(e){console.error("ä¿å­˜åŸºæœ¬è®¾ç½®å¤±è´¥:",e),a("ä¿å­˜å¤±è´¥: "+e.message,"error")}}),e.saveSettingsBtn.addEventListener("click",async function(){try{const t={theme:e.themeSelect.value,fontSize:e.fontSizeSelect.value,aiModel:e.aiModelSelect.value,geminiApiKey:e.geminiApiKeyInput.value.trim(),openaiApiKey:e.openaiApiKeyInput.value.trim(),claudeApiKey:e.claudeApiKeyInput.value.trim(),deepseekApiKey:e.deepseekApiKeyInput.value.trim(),qwenApiKey:e.qwenApiKeyInput.value.trim(),summaryLength:parseInt(e.summaryLengthRange.value),tagCount:parseInt(e.tagCountSelect.value),enableAutoTags:e.enableAutoTagsCheckbox.checked,enableCustomPrompt:e.enableCustomPromptCheckbox.checked,customPrompt:e.customPromptInput.value.trim()||n,saveOriginalContent:e.saveOriginalContentCheckbox.checked,saveImages:e.saveImagesCheckbox.checked,enableFloatButton:e.enableFloatButtonCheckbox.checked};if(t.aiModel&&!{gemini:t.geminiApiKey,openai:t.openaiApiKey,claude:t.claudeApiKey,deepseek:t.deepseekApiKey,qwen:t.qwenApiKey}[t.aiModel])return void a(`è¯·å…ˆé…ç½® ${{gemini:"Google Gemini",openai:"OpenAI",claude:"Anthropic Claude",deepseek:"DeepSeek",qwen:"é€šä¹‰åƒé—®"}[t.aiModel]} çš„ API Key`,"error");if(t.enableCustomPrompt&&t.customPrompt&&!t.customPrompt.includes("{{TEXT}}"))return void a("è‡ªå®šä¹‰æç¤ºè¯å¿…é¡»åŒ…å« {{TEXT}} å˜é‡","error");await chrome.storage.local.set(t),a("è®¾ç½®å·²ä¿å­˜ï¼","success")}catch(e){console.error("ä¿å­˜è®¾ç½®å¤±è´¥:",e),a("ä¿å­˜å¤±è´¥: "+e.message,"error")}}),e.testConnectionBtn.addEventListener("click",async function(){const t=e.aiModelSelect.value;if(t)if({gemini:e.geminiApiKeyInput.value.trim(),openai:e.openaiApiKeyInput.value.trim(),claude:e.claudeApiKeyInput.value.trim(),deepseek:e.deepseekApiKeyInput.value.trim(),qwen:e.qwenApiKeyInput.value.trim()}[t]){a("æ­£åœ¨æµ‹è¯•è¿žæŽ¥...","info"),e.testConnectionBtn.disabled=!0;try{await new Promise(e=>setTimeout(e,1e3)),a("âœ… è¿žæŽ¥æˆåŠŸï¼API Key æœ‰æ•ˆ","success")}catch(e){a("âŒ è¿žæŽ¥å¤±è´¥: "+e.message,"error")}finally{e.testConnectionBtn.disabled=!1}}else a(`è¯·å…ˆè¾“å…¥ ${{gemini:"Google Gemini",openai:"OpenAI",claude:"Anthropic Claude",deepseek:"DeepSeek",qwen:"é€šä¹‰åƒé—®"}[t]} çš„ API Key`,"error");else a("è¯·å…ˆé€‰æ‹© AI æ¨¡åž‹","error")}),e.backToDashboard.addEventListener("click",()=>{chrome.tabs.create({url:"dashboard.html"})}),e.toggleApiKeyButtons.forEach(e=>{e.addEventListener("click",()=>{!function(e){const t=e.dataset.target,n=document.getElementById(t);if(n){const t=n.type;n.type="password"===t?"text":"password",e.textContent="password"===t?"ðŸ™ˆ":"ðŸ‘ï¸"}}(e)})}),e.themeSelect.addEventListener("change",e=>{const t=e.target.value;window.applyThemeStyles?(window.applyThemeStyles(t),a('ä¸»é¢˜å·²é¢„è§ˆï¼Œè¯·ç‚¹å‡»"ä¿å­˜åŸºæœ¬è®¾ç½®"ä¿å­˜æ›´æ”¹',"info")):console.error("applyThemeStyles å‡½æ•°æœªæ‰¾åˆ°")}),e.fontSizeSelect.addEventListener("change",e=>{const t=e.target.value;window.applyFontSizeStyles?(window.applyFontSizeStyles(t),a('å­—ä½“å·²é¢„è§ˆï¼Œè¯·ç‚¹å‡»"ä¿å­˜åŸºæœ¬è®¾ç½®"ä¿å­˜æ›´æ”¹',"info")):console.error("applyFontSizeStyles å‡½æ•°æœªæ‰¾åˆ°")}),e.summaryLengthRange.addEventListener("input",t=>{e.summaryLengthValue.textContent=t.target.value}),e.enableCustomPromptCheckbox.addEventListener("change",t=>{t.target.checked?e.customPromptSection.classList.remove("hidden"):e.customPromptSection.classList.add("hidden")}),e.resetPromptBtn.addEventListener("click",()=>{e.customPromptInput.value=n,a("å·²æ¢å¤é»˜è®¤æç¤ºè¯","success")}),async function(){try{const a=await chrome.storage.local.get(["theme","fontSize","aiModel","apiKey","geminiApiKey","openaiApiKey","claudeApiKey","deepseekApiKey","qwenApiKey","summaryLength","tagCount","enableAutoTags","enableCustomPrompt","customPrompt","saveOriginalContent","saveImages","enableFloatButton"]);if(a.theme&&(e.themeSelect.value=a.theme),a.fontSize&&(e.fontSizeSelect.value=a.fontSize),a.aiModel&&(e.aiModelSelect.value=a.aiModel,t()),a.geminiApiKey&&(e.geminiApiKeyInput.value=a.geminiApiKey),a.openaiApiKey&&(e.openaiApiKeyInput.value=a.openaiApiKey),a.claudeApiKey&&(e.claudeApiKeyInput.value=a.claudeApiKey),a.deepseekApiKey&&(e.deepseekApiKeyInput.value=a.deepseekApiKey),a.qwenApiKey&&(e.qwenApiKeyInput.value=a.qwenApiKey),a.apiKey&&a.aiModel){const t={gemini:"geminiApiKey",openai:"openaiApiKey",claude:"claudeApiKey",deepseek:"deepseekApiKey",qwen:"qwenApiKey"}[a.aiModel];if(t&&!a[t]){const n={};n[t]=a.apiKey,await chrome.storage.local.set(n);const o=e[`${a.aiModel}ApiKeyInput`];o&&(o.value=a.apiKey),console.log(`å·²è¿ç§» API Key: ${a.aiModel} -> ${t}`)}}const o=a.summaryLength||200;e.summaryLengthRange.value=o,e.summaryLengthValue.textContent=o;const i=a.tagCount||3;e.tagCountSelect.value=i;const s=void 0===a.enableAutoTags||a.enableAutoTags;e.enableAutoTagsCheckbox.checked=s;const c=a.enableCustomPrompt||!1;e.enableCustomPromptCheckbox.checked=c;const l=a.customPrompt||n;e.customPromptInput.value=l;const u=void 0===a.saveOriginalContent||a.saveOriginalContent;e.saveOriginalContentCheckbox.checked=u;const m=void 0===a.saveImages||a.saveImages;e.saveImagesCheckbox.checked=m;const d=void 0===a.enableFloatButton||a.enableFloatButton;e.enableFloatButtonCheckbox.checked=d,c?e.customPromptSection.classList.remove("hidden"):e.customPromptSection.classList.add("hidden")}catch(e){console.error("åŠ è½½è®¾ç½®å¤±è´¥:",e)}}()})();