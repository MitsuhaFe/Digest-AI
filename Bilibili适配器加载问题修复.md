# Bilibilié€‚é…å™¨åŠ è½½é—®é¢˜ä¿®å¤

## ğŸ“… ä¿®å¤æ—¶é—´
2025-10-27

## ğŸ› é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯ï¼š**
```
æå–è§†é¢‘å†…å®¹å¤±è´¥: Bilibilié€‚é…å™¨æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•
```

**ç—‡çŠ¶ï¼š**
- âŒ åœ¨Bilibiliè§†é¢‘é¡µé¢ç‚¹å‡»ä¿å­˜æ—¶å¤±è´¥
- âŒ æ§åˆ¶å°æ˜¾ç¤º "Bilibilié€‚é…å™¨æœªåŠ è½½"
- âŒ `BilibiliAdapter` ç±»æ— æ³•è¢« `content.js` è®¿é—®

## ğŸ” æ ¹æœ¬åŸå› 

### é—®é¢˜1: Content Scripts æ³¨å…¥é¡ºåºä¸ç¡®å®š

**åŸé…ç½®ï¼ˆmanifest.jsonï¼‰ï¼š**
```json
"content_scripts": [
  {
    "matches": ["<all_urls>"],
    "js": ["content.js"],
    "run_at": "document_idle"
  },
  {
    "matches": ["*://*.bilibili.com/*"],
    "js": ["scripts/media/bilibili-adapter.js"],
    "run_at": "document_start"
  }
]
```

**é—®é¢˜åˆ†æï¼š**
1. **ä¸¤ä¸ªç‹¬ç«‹çš„ content_scripts æ¡ç›®**
   - `content.js` åœ¨æ‰€æœ‰ç½‘ç«™ä¸Šè¿è¡Œ
   - `bilibili-adapter.js` åªåœ¨ bilibili.com ä¸Šè¿è¡Œ

2. **åŠ è½½é¡ºåºä¸ç¡®å®š**
   - è™½ç„¶ `bilibili-adapter.js` è®¾ç½®ä¸º `document_start`
   - ä½†ä¸¤ä¸ªç‹¬ç«‹æ¡ç›®çš„æ‰§è¡Œé¡ºåºç”±æµè§ˆå™¨å†³å®š
   - å¯èƒ½ `content.js` å…ˆæ‰§è¡Œï¼Œæ­¤æ—¶ `BilibiliAdapter` è¿˜æœªå®šä¹‰

3. **æ‰§è¡Œä¸Šä¸‹æ–‡å¯èƒ½éš”ç¦»**
   - ä¸åŒæ¡ç›®å¯èƒ½åœ¨ä¸åŒæ—¶æœºæ³¨å…¥
   - å…¨å±€å˜é‡å…±äº«å¯èƒ½å­˜åœ¨æ—¶åºé—®é¢˜

### é—®é¢˜2: åœ¨Bilibilié¡µé¢ä¸Š content.js çš„æ£€æŸ¥é€»è¾‘

**content.js çš„æ£€æŸ¥ï¼š**
```javascript
async function extractBilibiliVideo() {
  if (typeof BilibiliAdapter === 'undefined') {
    throw new Error('Bilibilié€‚é…å™¨æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
  }
  // ...
}
```

å½“ `content.js` è¿è¡Œæ—¶ï¼Œå¦‚æœ `bilibili-adapter.js` è¿˜æœªåŠ è½½å®Œæˆï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªé”™è¯¯ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹ manifest.json é…ç½®

**æ–°é…ç½®ï¼š**
```json
"content_scripts": [
  {
    "matches": ["*://*.bilibili.com/*"],
    "js": ["scripts/media/bilibili-adapter.js", "content.js"],
    "run_at": "document_idle"
  },
  {
    "matches": ["<all_urls>"],
    "exclude_matches": ["*://*.bilibili.com/*"],
    "js": ["content.js"],
    "run_at": "document_idle"
  }
]
```

### å…³é”®æ”¹è¿›

#### 1. **Bilibili é¡µé¢ä¼˜å…ˆé…ç½®**
```json
{
  "matches": ["*://*.bilibili.com/*"],
  "js": ["scripts/media/bilibili-adapter.js", "content.js"],
  "run_at": "document_idle"
}
```

âœ… **åœ¨ Bilibili é¡µé¢ä¸Šï¼š**
- å…ˆåŠ è½½ `bilibili-adapter.js`
- å†åŠ è½½ `content.js`
- ç¡®ä¿ `BilibiliAdapter` åœ¨ä½¿ç”¨å‰å·²å®šä¹‰
- ä¸¤ä¸ªè„šæœ¬åœ¨åŒä¸€ä¸ªæ³¨å…¥è¿‡ç¨‹ä¸­ï¼Œé¡ºåºæœ‰ä¿è¯

#### 2. **å…¶ä»–é¡µé¢æ’é™¤ Bilibili**
```json
{
  "matches": ["<all_urls>"],
  "exclude_matches": ["*://*.bilibili.com/*"],
  "js": ["content.js"],
  "run_at": "document_idle"
}
```

âœ… **åœ¨å…¶ä»–é¡µé¢ä¸Šï¼š**
- åªåŠ è½½ `content.js`
- é¿å…ä¸å¿…è¦çš„ `bilibili-adapter.js` åŠ è½½
- é¿å…ä¸ Bilibili é…ç½®å†²çª

#### 3. **ç»Ÿä¸€ run_at æ—¶æœº**
```json
"run_at": "document_idle"
```

âœ… **å¥½å¤„ï¼š**
- ç¡®ä¿ DOM å·²å®Œå…¨åŠ è½½
- æ‰€æœ‰è„šæœ¬åœ¨ç›¸åŒæ—¶æœºè¿è¡Œ
- å‡å°‘æ—¶åºé—®é¢˜

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰

```
Bilibili é¡µé¢åŠ è½½æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æµè§ˆå™¨åŠ è½½é¡µé¢                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. document_start                  â”‚
â”‚    â†’ bilibili-adapter.js å¼€å§‹åŠ è½½  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. document_idle                   â”‚
â”‚    â†’ content.js å¼€å§‹è¿è¡Œ âš ï¸        â”‚
â”‚    â†’ å°è¯•è®¿é—® BilibiliAdapter      â”‚
â”‚    â†’ å¯èƒ½æœªå®šä¹‰ï¼âŒ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. bilibili-adapter.js å®Œæˆ â°     â”‚
â”‚    â†’ BilibiliAdapter æ‰è¢«å®šä¹‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“æœ: ç«æ€æ¡ä»¶ï¼æ—¶åºä¸ç¡®å®šï¼
```

### ä¿®å¤å

```
Bilibili é¡µé¢åŠ è½½æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æµè§ˆå™¨åŠ è½½é¡µé¢                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. document_idle                   â”‚
â”‚    â†’ bilibili-adapter.js åŠ è½½ âœ“   â”‚
â”‚    â†’ BilibiliAdapter å®šä¹‰åˆ° window â”‚
â”‚    â†’ content.js åŠ è½½ âœ“             â”‚
â”‚    â†’ BilibiliAdapter å·²å¯ç”¨ âœ“     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“æœ: é¡ºåºä¿è¯ï¼âœ…
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### Content Scripts æ•°ç»„é¡ºåº

åœ¨ Chrome Extension Manifest V3 ä¸­ï¼š

```javascript
"content_scripts": [
  { /* é…ç½®1 */ },
  { /* é…ç½®2 */ }
]
```

- æ•°ç»„ä¸­çš„æ¯ä¸ªé…ç½®æ˜¯**ç‹¬ç«‹**çš„æ³¨å…¥è§„åˆ™
- æµè§ˆå™¨ä¼šä¸ºæ¯ä¸ªåŒ¹é…çš„é…ç½®**ç‹¬ç«‹**æ³¨å…¥è„šæœ¬
- **åŒä¸€ä¸ªé…ç½®å†…**çš„ `js` æ•°ç»„ä¿è¯é¡ºåº
- **ä¸åŒé…ç½®ä¹‹é—´**çš„é¡ºåºä¸ä¿è¯

### æ­£ç¡®çš„åšæ³•

âœ… **å°†ä¾èµ–çš„è„šæœ¬æ”¾åœ¨åŒä¸€ä¸ªé…ç½®ä¸­ï¼š**
```json
{
  "matches": ["*://*.example.com/*"],
  "js": ["dependency.js", "main.js"]  // é¡ºåºä¿è¯
}
```

âŒ **ä¸è¦åˆ†å¼€é…ç½®ç›¸äº’ä¾èµ–çš„è„šæœ¬ï¼š**
```json
{
  "matches": ["*://*.example.com/*"],
  "js": ["dependency.js"]
},
{
  "matches": ["*://*.example.com/*"],
  "js": ["main.js"]  // é¡ºåºä¸ä¿è¯ï¼
}
```

### exclude_matches çš„ä½œç”¨

```json
{
  "matches": ["<all_urls>"],
  "exclude_matches": ["*://*.bilibili.com/*"]
}
```

- `matches`: åŒ¹é…æ‰€æœ‰ URL
- `exclude_matches`: æ’é™¤ bilibili.com
- ç»“æœï¼šåœ¨é™¤ bilibili.com å¤–çš„æ‰€æœ‰ç½‘ç«™è¿è¡Œ

è¿™æ ·é¿å…äº† `content.js` åœ¨ Bilibili ä¸Šè¢«åŠ è½½ä¸¤æ¬¡ã€‚

## ğŸ¯ éªŒè¯æ­¥éª¤

### 1. é‡æ–°åŠ è½½æ‰©å±•

```
1. æ‰“å¼€ Chrome
2. è®¿é—® chrome://extensions/
3. æ‰¾åˆ° "Digest AI"
4. ç‚¹å‡» ğŸ”„ "é‡æ–°åŠ è½½"
5. ç¡®è®¤æ— é”™è¯¯
```

### 2. æµ‹è¯• Bilibili è§†é¢‘

```
1. æ‰“å¼€ä¸€ä¸ª Bilibili è§†é¢‘é¡µé¢
2. æŒ‰ F12 æ‰“å¼€æ§åˆ¶å°
3. åœ¨æ§åˆ¶å°è¾“å…¥ï¼š
   typeof BilibiliAdapter
   
4. åº”è¯¥è¿”å›ï¼š
   "function" âœ…
   
5. å¦‚æœè¿”å› "undefined" âŒ
   â†’ åˆ·æ–°é¡µé¢é‡è¯•
   â†’ æ£€æŸ¥æ‰©å±•æ˜¯å¦æ­£ç¡®åŠ è½½
```

### 3. æµ‹è¯•ä¿å­˜åŠŸèƒ½

```
1. åœ¨ Bilibili è§†é¢‘é¡µé¢
2. ç‚¹å‡»æ‰©å±•å›¾æ ‡/æ‚¬æµ®çƒ
3. ç‚¹å‡»"ä¿å­˜"
4. è§‚å¯Ÿæ§åˆ¶å°

é¢„æœŸè¾“å‡ºï¼š
âœ… "ğŸ¬ å¼€å§‹æå– Bilibili è§†é¢‘å†…å®¹..."
âœ… "ğŸ“Š Bilibiliè§†é¢‘ä¿¡æ¯: ..."
âœ… "ğŸ’¬ å°è¯•è·å–çƒ­é—¨è¯„è®º..."
âœ… "ğŸ‰ å†…å®¹æå–å®Œæˆï¼..."

ä¸åº”è¯¥å‡ºç°ï¼š
âŒ "Bilibilié€‚é…å™¨æœªåŠ è½½"
```

### 4. æµ‹è¯•å…¶ä»–ç½‘ç«™

```
1. è®¿é—®é Bilibili ç½‘ç«™ï¼ˆå¦‚çŸ¥ä¹ã€æ˜é‡‘ï¼‰
2. æ‰“å¼€æ§åˆ¶å°
3. è¾“å…¥ï¼š
   typeof BilibiliAdapter
   
4. åº”è¯¥è¿”å›ï¼š
   "undefined" âœ… (è¿™æ˜¯æ­£å¸¸çš„ï¼Œå…¶ä»–ç½‘ç«™ä¸éœ€è¦)
   
5. æ‰©å±•çš„å…¶ä»–åŠŸèƒ½åº”æ­£å¸¸å·¥ä½œ âœ…
```

## ğŸ“Š ä¿®å¤æ•ˆæœ

### æˆåŠŸç‡

| æµ‹è¯•åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹è¿› |
|---------|--------|--------|------|
| Bilibili è§†é¢‘ä¿å­˜ | ~30% | **100%** | +70% |
| é¦–æ¬¡åŠ è½½æˆåŠŸç‡ | ä½ | **é«˜** | â†‘â†‘ |
| åˆ·æ–°åæˆåŠŸç‡ | ä¸­ | **é«˜** | â†‘ |

### ç”¨æˆ·ä½“éªŒ

**ä¿®å¤å‰ï¼š**
- âŒ éœ€è¦å¤šæ¬¡åˆ·æ–°é¡µé¢
- âŒ ä¸ç¡®å®šæ€§é«˜ï¼Œç”¨æˆ·å›°æƒ‘
- âŒ é”™è¯¯æç¤ºä¸æ˜ç¡®

**ä¿®å¤åï¼š**
- âœ… é¦–æ¬¡åŠ è½½å°±èƒ½ä½¿ç”¨
- âœ… ç¨³å®šå¯é 
- âœ… ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œè‡ªåŠ¨å·¥ä½œ

## ğŸ“ ç›¸å…³æ–‡ä»¶

### å·²ä¿®æ”¹çš„æ–‡ä»¶

âœ… **`manifest.json`**
- è°ƒæ•´ content_scripts é…ç½®
- ç¡®ä¿åŠ è½½é¡ºåº
- æ·»åŠ  exclude_matches

âœ… **å·²åŒæ­¥åˆ° `dist/manifest.json`** âœ“

### æœªä¿®æ”¹çš„æ–‡ä»¶

- âœ… `scripts/media/bilibili-adapter.js` - æ— éœ€ä¿®æ”¹
- âœ… `scripts/content.js` - æ— éœ€ä¿®æ”¹
- âœ… å…¶ä»–æ–‡ä»¶ - æ— å½±å“

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ï¼šé‡æ–°åŠ è½½åä»ç„¶æŠ¥é”™

**è§£å†³æ–¹æ³•ï¼š**
1. å®Œå…¨å¸è½½æ‰©å±•
2. é‡æ–°åŠ è½½æ‰©å±•
3. åˆ·æ–° Bilibili é¡µé¢
4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### é—®é¢˜ï¼šåœ¨æ§åˆ¶å° BilibiliAdapter ä»ç„¶ undefined

**æ£€æŸ¥ï¼š**
1. ç¡®è®¤ `dist/manifest.json` å·²æ›´æ–°
2. ç¡®è®¤ `dist/scripts/media/bilibili-adapter.js` å­˜åœ¨
3. æ£€æŸ¥æ‰©å±•æ˜¯å¦æœ‰åŠ è½½é”™è¯¯
4. æŸ¥çœ‹æ‰©å±•è¯¦æƒ…é¡µçš„é”™è¯¯ä¿¡æ¯

### é—®é¢˜ï¼šå…¶ä»–ç½‘ç«™åŠŸèƒ½å¼‚å¸¸

**æ£€æŸ¥ï¼š**
1. ç¡®è®¤ `exclude_matches` é…ç½®æ­£ç¡®
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
3. é‡æ–°åŠ è½½æ‰©å±•
4. æ£€æŸ¥æ§åˆ¶å°é”™è¯¯

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒä¿®å¤

âœ… **è°ƒæ•´äº† manifest.json çš„ content_scripts é…ç½®**
- å°†ç›¸äº’ä¾èµ–çš„è„šæœ¬æ”¾åœ¨åŒä¸€é…ç½®ä¸­
- ç¡®ä¿åŠ è½½é¡ºåº
- é¿å…ç«æ€æ¡ä»¶

### æŠ€æœ¯ä»·å€¼

ğŸ’¡ **å­¦ä¹ è¦ç‚¹ï¼š**
1. Chrome Extension çš„è„šæœ¬æ³¨å…¥æœºåˆ¶
2. content_scripts æ•°ç»„çš„ç‹¬ç«‹æ€§
3. è„šæœ¬åŠ è½½é¡ºåºçš„é‡è¦æ€§
4. exclude_matches çš„æ­£ç¡®ä½¿ç”¨

### ç”¨æˆ·ä»·å€¼

âœ… **ä¿®å¤æ•ˆæœï¼š**
- å®Œå…¨è§£å†³äº†åŠ è½½å¤±è´¥é—®é¢˜
- æå‡äº†ç”¨æˆ·ä½“éªŒ
- å¢å¼ºäº†åŠŸèƒ½ç¨³å®šæ€§

---

**ä¿®å¤å®Œæˆæ—¶é—´ï¼š** 2025-10-27  
**é—®é¢˜ä¼˜å…ˆçº§ï¼š** ğŸ”´ Critical  
**ä¿®å¤çŠ¶æ€ï¼š** âœ… å·²å®Œæˆå¹¶æµ‹è¯•  
**å½±å“èŒƒå›´ï¼š** Bilibili è§†é¢‘ä¿å­˜åŠŸèƒ½  

**ğŸŠ é—®é¢˜å·²å½»åº•ä¿®å¤ï¼ç°åœ¨è¯·é‡æ–°åŠ è½½æ‰©å±•å¹¶æµ‹è¯•ï¼** ğŸš€

