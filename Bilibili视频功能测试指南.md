# Bilibili 视频功能测试指南

## 🎯 测试目标

验证 Digest AI 的 Bilibili 视频读取和摘要功能是否正常工作。

## 📋 测试前准备

### 1. 确保文件已更新

需要更新的文件：
- ✅ `scripts/media/bilibili-adapter.js` (新建)
- ✅ `scripts/content.js` (已修改)
- ✅ `scripts/background.js` (已修改)
- ✅ `manifest.json` (已修改)
- ✅ `dashboard.js` (已修改)
- ✅ `styles/dashboard.css` (已修改)

### 2. 重新加载扩展

1. 打开 `chrome://extensions/`
2. 找到 "Digest AI" 扩展
3. 点击刷新按钮 🔄
4. 确保扩展已启用

### 3. 配置 API Key

1. 点击扩展图标
2. 进入设置页面
3. 选择 AI 模型（推荐使用 Gemini）
4. 输入对应的 API Key
5. 保存设置

## 🧪 测试用例

### 测试用例 1: 有字幕的视频

**测试视频：** 找一个有中文字幕的 Bilibili 技术教程视频

**测试步骤：**
1. 打开 Bilibili 视频页面（如：https://www.bilibili.com/video/BV1xx411c7mD）
2. 等待页面完全加载
3. 点击浏览器工具栏的 Digest AI 图标
4. 点击"保存文章"按钮
5. 观察处理过程

**预期结果：**
- ✅ 显示"提取文章内容中..."
- ✅ 显示"正在分析..."
- ✅ 成功显示视频标题
- ✅ 显示 AI 生成的摘要
- ✅ 显示核心观点
- ✅ 显示推荐标签
- ✅ 提示"保存成功"

**验证点：**
- 摘要内容是否基于视频字幕生成
- 核心观点是否准确提取
- 标签是否相关

### 测试用例 2: 无字幕的视频

**测试视频：** 找一个没有字幕的 Bilibili 视频

**测试步骤：**
同上

**预期结果：**
- ✅ 仍能成功保存
- ✅ 摘要基于视频简介生成
- ✅ 在详情页显示"此视频没有字幕"提示

### 测试用例 3: 阅读库显示

**测试步骤：**
1. 保存几个视频后，打开阅读库
2. 观察视频在列表中的显示

**预期结果：**
- ✅ 视频卡片有 🎥 图标
- ✅ 显示视频时长
- ✅ 视频卡片有红色左边框
- ✅ 点击后能查看详情

### 测试用例 4: 视频详情页

**测试步骤：**
1. 在阅读库中点击一个视频
2. 查看详情页内容

**预期结果：**
- ✅ 显示"🎥 视频信息"标题
- ✅ 显示视频元数据：
  - 时长
  - UP主
  - 发布时间
  - 播放量
  - 点赞数
- ✅ 显示字幕内容（如有）或提示无字幕
- ✅ 显示视频简介
- ✅ 显示"观看视频"按钮
- ✅ 点击按钮能跳转到原视频

### 测试用例 5: 悬浮球快捷保存

**测试步骤：**
1. 在 Bilibili 视频页面
2. 找到右下角的悬浮球 📚
3. 直接点击悬浮球

**预期结果：**
- ✅ 显示保存动画
- ✅ 显示成功提示"✅ 文章已保存"
- ✅ 视频被正确保存到阅读库

## 🐛 常见问题排查

### 问题 1: 提示"Bilibili适配器未加载"

**原因：** 扩展未正确加载 bilibili-adapter.js

**解决方法：**
1. 检查 `manifest.json` 是否包含：
```json
{
  "matches": ["*://*.bilibili.com/*"],
  "js": ["scripts/media/bilibili-adapter.js"],
  "run_at": "document_start"
}
```
2. 完全关闭 Bilibili 标签页
3. 重新加载扩展
4. 重新打开 Bilibili 页面

### 问题 2: 无法获取字幕

**原因：** 视频没有上传字幕

**解决方法：**
- 这是正常现象
- 扩展会自动使用视频简介作为内容
- 仍可生成 AI 摘要

### 问题 3: AI 摘要生成失败

**可能原因：**
1. API Key 未配置或无效
2. API 配额用尽
3. 网络连接问题

**解决方法：**
1. 检查设置页面的 API Key
2. 打开浏览器控制台（F12）查看错误信息
3. 检查网络连接
4. 尝试使用其他 AI 模型

### 问题 4: 视频元数据显示不完整

**可能原因：** Bilibili 页面结构变化

**解决方法：**
1. 刷新页面重试
2. 检查浏览器控制台的错误信息
3. 确认视频页面已完全加载

## 📊 性能测试

### 测试不同视频时长的处理时间

| 视频时长 | 预期处理时间 | 实际处理时间 |
|---------|------------|------------|
| < 5分钟  | 5-10秒     | ____秒 |
| 5-15分钟 | 10-20秒    | ____秒 |
| 15-30分钟| 20-30秒    | ____秒 |
| > 30分钟 | 30-60秒    | ____秒 |

### 测试有/无字幕的差异

| 视频类型 | 摘要质量 | 处理时间 | 备注 |
|---------|---------|---------|-----|
| 有字幕   | ⭐⭐⭐⭐⭐ | ____秒 |  |
| 无字幕   | ⭐⭐⭐   | ____秒 | 基于简介 |

## ✅ 验收标准

完成以下所有项目表示功能正常：

- [ ] 能正确识别 Bilibili 视频页面
- [ ] 能提取视频基本信息（标题、UP主、时长等）
- [ ] 能获取视频字幕（如果有）
- [ ] 能基于字幕/简介生成 AI 摘要
- [ ] 能生成核心观点和推荐标签
- [ ] 视频在阅读库中有特殊标识
- [ ] 视频详情页显示完整元数据
- [ ] 悬浮球快捷保存功能正常
- [ ] 搜索功能对视频有效
- [ ] 标签系统对视频有效
- [ ] 删除视频功能正常
- [ ] 导出 Markdown 对视频有效

## 🎓 高级测试

### 测试边界情况

1. **超长视频（>2小时）**
   - 测试处理时间
   - 测试字幕完整性
   - 测试摘要质量

2. **多P视频**
   - 当前版本应处理第一P
   - 验证是否正确处理

3. **私有/会员视频**
   - 测试错误处理
   - 验证提示信息

4. **连续保存多个视频**
   - 测试性能稳定性
   - 测试内存使用

### 测试不同 AI 模型

对同一视频使用不同 AI 模型生成摘要：

| AI 模型 | 摘要质量 | 处理时间 | 成本 | 备注 |
|--------|---------|---------|-----|-----|
| Gemini | ⭐⭐⭐⭐ | ____秒 | 低 | 推荐 |
| OpenAI | ⭐⭐⭐⭐⭐| ____秒 | 中 |  |
| Claude | ⭐⭐⭐⭐⭐| ____秒 | 高 |  |
| DeepSeek | ⭐⭐⭐⭐| ____秒 | 低 | 推荐 |
| 通义千问 | ⭐⭐⭐⭐ | ____秒 | 低 |  |

## 📝 测试记录模板

```
测试日期：____年____月____日
测试人员：________
浏览器版本：Chrome ________
扩展版本：0.1.0

测试结果：
□ 通过
□ 失败

问题描述：
________________________________
________________________________

截图/日志：
[附加截图或控制台日志]

建议：
________________________________
________________________________
```

## 🚀 下一步

如果所有测试通过：
1. ✅ 功能开发完成
2. 📝 更新用户文档
3. 🎉 准备发布 V3.0-Beta

如果测试失败：
1. 📋 记录详细的错误信息
2. 🐛 修复 bug
3. 🔄 重新测试

---

**测试完成后请填写测试报告并保存！**

